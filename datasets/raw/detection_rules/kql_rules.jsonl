{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: A request to a web application server contained no identifying user agent string.", "output": "url.path:*\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects when an internal network client sends DNS traffic directly to the Internet. This is atypical behavior\nfor a managed network and can ...", "output": "event.category:(network or network_traffic) and (event.type:connection or type:dns) and (destination.port:53 or event.dataset:zeek.dns)\n  and source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule detects events that may indicate the use of FTP network connections to the Internet. The File Transfer\nProtocol (FTP) has been around in its...", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(20 or 21) or event.dataset:zeek.ftp) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Exfiltration Over Alternative Protocol", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(6667 or 6697) or event.dataset:zeek.irc) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Protocol Tunneling", "output": "event.category:process and host.os.type:linux and event.type:(start or process_started) and process.name:(iodine or iodined)\n", "source": "detection-rules/_deprecated", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "TCP Port 8000 is commonly used for development environments of web server software. It generally should not be exposed\ndirectly to the Internet. If yo...", "output": "event.category:(network or network_traffic) and network.transport:tcp and destination.port:8000 and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects events that may indicate use of a PPTP VPN connection. Some threat actors use these types of\nconnections to tunnel their traffic whi...", "output": "event.category:(network or network_traffic) and network.transport:tcp and destination.port:1723\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule detects events that may describe network events of proxy use to the Internet. It includes popular HTTP proxy\nports and SOCKS proxy ports. Ty...", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(1080 or 3128 or 8080) or event.dataset:zeek.socks) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects events that may describe SMTP traffic from internal hosts to a host across the Internet. In an\nenterprise network, there is typicall...", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(25 or 465 or 587) or event.dataset:zeek.smtp) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects events that may describe database traffic (MS SQL, Oracle, MySQL, and Postgresql) across the Internet.\nDatabases should almost never...", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:(1433 or 1521 or 3306 or 5432) or event.dataset:zeek.mysql) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects network events that may indicate the use of SSH traffic from the Internet. SSH is commonly used by\nsystem administrators to remotely...", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:22 or event.dataset:zeek.ssh) and\n  not source.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  ) and\n  destination.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  )\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects network events that may indicate the use of SSH traffic from the Internet. SSH is commonly used by\nsystem administrators to remotely...", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:22 or event.dataset:zeek.ssh) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects network events that may indicate the use of Tor traffic to the Internet. Tor is a network protocol\nthat sends traffic through a seri...", "output": "event.category:(network or network_traffic) and network.transport:tcp and destination.port:(9001 or 9030) and\n  source.ip:(10.0.0.0/8 or\n             172.16.0.0/12 or\n             192.168.0.0/16) and\n\n  not destination.ip:(10.0.0.0/8 or\n                      127.0.0.0/8 or\n                      169.254.0.0/16 or\n                      172.16.0.0/12 or\n                      192.168.0.0/16 or\n                      224.0.0.0/4 or\n                      \"::1\" or\n                      \"FE80::/10\" or\n                      \"FF00::/8\")\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Generates a detection alert each time a 'Container Workload Protection' alert is received. Enabling this rule allows you\nto immediately begin triaging...", "output": "event.kind:alert and event.module:cloud_defend\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Brute Force", "output": "event.dataset:o365.audit and event.provider:(Exchange or AzureActiveDirectory) and event.category:authentication and\nevent.action:(\"UserLoginFailed\" or \"PasswordLogonInitialAuthUsingPassword\")\n", "source": "detection-rules/_deprecated", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: The Tcpdump program ran on a Linux host. Tcpdump is a network monitoring or packet sniffing tool that can be used to\ncapture insecure credentials or d...", "output": "event.category:process and event.type:(start or process_started) and process.name:tcpdump\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Adversaries may attempt to disable the iptables or firewall service in an attempt to affect how a host is allowed to\nreceive or send network traffic.\n", "output": "event.category:process and event.type:(start or process_started) and\n  process.name:ufw and process.args:(allow or disable or reset) or\n\n  (((process.name:service and process.args:stop) or\n     (process.name:chkconfig and process.args:off) or\n     (process.name:systemctl and process.args:(disable or stop or kill))) and\n   process.args:(firewalld or ip6tables or iptables))\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Adversaries may encode/decode data in an attempt to evade detection by host- or network-based security controls.", "output": "event.category:process and event.type:(start or process_started) and\n  process.name:(base64 or base64plain or base64url or base64mime or base64pem)\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Trusted Developer Utilities Proxy Execution", "output": "event.category:process and event.type:(start or process_started) and process.name:(MSBuild.exe or msxsl.exe)\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Adversaries may encode/decode data in an attempt to evade detection by host- or network-based security controls.", "output": "event.category:process and event.type:(start or process_started) and process.name:(hexdump or od or xxd)\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Adversaries may attempt to get information about running processes on a system.", "output": "event.category:process and event.type:(start or process_started) and process.name:tasklist.exe\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: The whoami application was executed on a Linux host. This is often used by tools and persistence mechanisms to test for\nprivileged access.\n", "output": "event.category:process and event.type:(start or process_started) and process.name:whoami\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies a suspicious parent child process relationship with cmd.exe descending from PowerShell.exe.", "output": "event.category:process and event.type:(start or process_started) and\n  process.parent.name:powershell.exe and process.name:cmd.exe\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies processes running in a temporary folder. This is sometimes done by adversaries to hide malware.", "output": "event.category:process and event.type:(start or process_started) and process.working_directory:/tmp and\n  not process.parent.name:(update-motd-updates-available or\n                           apt or apt-* or\n                           cnf-update-db or\n                           appstreamcli or\n                           unattended-upgrade or\n                           packagekitd) and\n  not process.args:(/usr/lib/update-notifier/update-motd-updates-available or\n                    /var/lib/command-not-found/)\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Command and Scripting Interpreter", "output": "event.category:process and event.type:(\"start\" or \"process_started\") and process.parent.name:\"java\" and process.name:(\n  bash or dash or sh or tcsh or csh or zsh or ksh or fish or python* or php* or perl or ruby or lua* or openssl or\n  nc or netcat or ncat or telnet or awk or socat or wget or curl\n) and process.args :(\n  whoami or id or uname or cat or hostname or ip or curl or wget or pwd or ls or cd or python* or php* or perl or\n  ruby or lua* or openssl or nc or netcat or ncat or telnet or awk or socat\n)\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: RegSvcs.exe and RegAsm.exe are Windows command line utilities that are used to register .NET Component Object Model\n(COM) assemblies. Adversaries can ...", "output": "event.category:process and event.type:(start or process_started) and process.name:(RegAsm.exe or RegSvcs.exe)\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: An attempt was made to modify AWS EC2 snapshot attributes. Snapshots are sometimes shared by threat actors in order to\nexfiltrate bulk data from an EC...", "output": "event.dataset:aws.cloudtrail and event.provider:ec2.amazonaws.com and event.action:ModifySnapshotAttribute\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies when a virtual network device is modified or deleted. This can be a network virtual appliance, virtual hub,\nor virtual router.\n\n**Deprecate...", "output": "event.dataset:azure.activitylogs and azure.activitylogs.operation_name:(\"MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE\" or\n\"MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE\" or \"MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE\" or\n\"MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION\" or \"MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE\" or\n\"MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE\" or \"MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE\" or\n\"MICROSOFT.NETWORK/VIRTUALHUBS/DELETE\" or \"MICROSOFT.NETWORK/VIRTUALHUBS/WRITE\" or\n\"MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE\" or \"MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE\") and\nevent.outcome:(Success or success)\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Valid Accounts", "output": "event.module:auditd and event.action:\"failed-log-in-too-many-times-to\"\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies that a login attempt has happened from a forbidden location.", "output": "event.module:auditd and event.action:\"attempted-log-in-from-unusual-place-to\"\n", "source": "detection-rules/_deprecated", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies that the maximum number login sessions has been reached for a user.", "output": "event.module:auditd and event.action:\"opened-too-many-sessions-to\"\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies that a login attempt occurred at a forbidden time.", "output": "event.module:auditd and event.action:\"attempted-log-in-during-unusual-hour-to\"\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Exploit Public-Facing Application", "output": "event.category:(network or network_traffic) and network.transport:tcp and (destination.port:3389 or event.dataset:zeek.rdp) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.168.0.0/16 or\n    224.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: The Linux mknod program is sometimes used in the command payload of a remote command injection (RCI) and other exploits.\nIt is used to export a comman...", "output": "event.category:process and event.type:(start or process_started) and process.name:mknod\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Nmap was executed on a Linux host. Nmap is a FOSS tool for network scanning and security testing. It can map and\ndiscover networks, and identify liste...", "output": "event.category:process and event.type:(start or process_started) and process.name:nmap\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: A Socat process is running on a Linux host. Socat is often used as a persistence mechanism by exporting a reverse shell,\nor by serving a shell on a li...", "output": "event.category:process and event.type:(start or process_started) and process.name:socat and not process.args:-V\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies the creation or execution of a cron job. Adversaries may abuse cron jobs to perform task scheduling for\ninitial or recurring execution of m...", "output": "event.category:process and event.type:(start or process_started or info) and\n  not user.name:root and\n  ((process.name:crontab and not process.args:(\"-l\" or \"-r\" or \"-e\" or \"-help\" or \"-h\")) or\n    (process.parent.name:cron and not process.name:\"running job\" and\n       not process.executable:(/Applications/Docker.app/Contents/Resources/bin/docker or\n                               /usr/bin/killall or\n                               /usr/sbin/sendmail or\n                               /usr/bin/env or\n                               /usr/bin/timeshift or\n                               /bin/rm)))\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: User groups in Google Workspace are created to help manage users permissions and access to various resources and\napplications. The security label is o...", "output": "event.dataset:\"google_workspace.admin\" and event.action:\"CHANGE_GROUP_SETTING\" and event.category:\"iam\"\n    and ((google_workspace.admin.setting.name:\"ALLOW_EXTERNAL_MEMBERS\" and google_workspace.admin.new_value:\"true\")\n        or (google_workspace.admin.setting.name:\"WHO_CAN_JOIN\" and not (google_workspace.admin.new_value:\"INVITED_CAN_JOIN\"\n            or google_workspace.admin.new_value:\"CAN_REQUEST_TO_JOIN\")))\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies loadable kernel module errors, which are often indicative of potential persistence attempts.", "output": "event.category:process and event.type:(start or process_started) and process.name:(insmod or kmod or modprobe or rmod)\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Server Software Component", "output": "event.category:process and host.os.type:linux and event.type:(start or process_started) and\nprocess.name:(bash or dash or ash or zsh or \"python*\" or \"perl*\" or \"php*\") and\nprocess.parent.name:(\"apache\" or \"nginx\" or \"www\" or \"apache2\" or \"httpd\" or \"www-data\")\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies the creation or patching of potentially malicious role bindings. Users can use role bindings and cluster role\nbindings to assign roles to K...", "output": "event.dataset:(googlecloud.audit or gcp.audit) and event.action:(io.k8s.authorization.rbac.v*.clusterrolebindings.create or\nio.k8s.authorization.rbac.v*.rolebindings.create or io.k8s.authorization.rbac.v*.clusterrolebindings.patch or\nio.k8s.authorization.rbac.v*.rolebindings.patch) and event.outcome:success and\nnot gcp.audit.authentication_info.principal_email:\"system:addon-manager\"\n", "source": "detection-rules/_deprecated", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Strace is a useful diagnostic, instructional, and debugging tool. This rule identifies a privileged context execution of\nstrace which can be used to e...", "output": "event.category:process and event.type:(start or process_started) and process.name:strace\n", "source": "detection-rules/_deprecated", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "This rule is triggered when indicators from the Threat Intel Filebeat module (v7.x) has a match against local file or\nnetwork observations.\n", "output": "file.hash.*:* or file.pe.imphash:* or source.ip:* or destination.ip:* or url.full:* or registry.path:*\n", "source": "detection-rules/_deprecated", "severity": "critical", "risk_score": 99}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule is triggered when indicators from the Threat Intel Filebeat module (v8.x) has a match against local file or\nnetwork observations. This rule ...", "output": "file.hash.*:* or file.pe.imphash:* or source.ip:* or destination.ip:* or url.full:* or registry.path:*\n", "source": "detection-rules/_deprecated", "severity": "critical", "risk_score": 99}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule is triggered when indicators from the Threat Intel integrations have a match against local file or network\nobservations. This rule was depre...", "output": "file.hash.*:* or file.pe.imphash:* or source.ip:* or destination.ip:* or url.full:* or registry.path:*\n", "source": "detection-rules/_deprecated", "severity": "critical", "risk_score": 99}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: A POST request to a web application returned a 403 response, which indicates the web application declined to process the\nrequest because the action re...", "output": "http.response.status_code:403 and http.request.method:post\n", "source": "detection-rules/apm", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "A request to a web application returned a 405 response, which indicates the web application declined to process the\nrequest because the HTTP method is...", "output": "http.response.status_code:405\n", "source": "detection-rules/apm", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects events that have a mismatch on the expected event agent ID. The status \"agent_id_mismatch/mismatch\" occurs when\nthe expected agent ID associat...", "output": "event.agent_id_status:(agent_id_mismatch or mismatch)\n", "source": "detection-rules/cross-platform", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects when multiple hosts are using the same agent ID. This could occur in the event of an agent being taken over and\nused to inject illegitimate do...", "output": "event.agent_id_status:* and not tags:forwarded\n", "source": "detection-rules/cross-platform", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Identifies the use of the AWS Systems Manager (SSM) `SendCommand` API with the either `AWS-RunShellScript` or\n`AWS-RunPowerShellScript` parameters. Th...", "output": "event.category: \"process\" and event.type: \"start\" and process.name: \"aws\"\nand (\n    host.os.type: (\"windows\" or \"macos\")\n    or (\n        host.os.type: \"linux\"\n        and event.action: (\"exec\" or \"exec_event\" or \"executed\" or \"process_started\")\n    )\n)\nand process.args: (\n    \"send-command\" and \"--parameters\" and commands=*\n    and (\"AWS-RunShellScript\" or \"AWS-RunPowerShellScript\")\n)\n", "source": "detection-rules/cross-platform", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Command and Scripting Interpreter", "output": "event.category:process and event.type:(process_started or start) and process.name:espl and process.args:eyJkZWJ1ZyI6*\n", "source": "detection-rules/cross-platform", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule helps you test and practice using alerts with Elastic Security as you get set up. Itâ€™s not a sign of threat\nactivity.\n", "output": "event.kind:event\n", "source": "detection-rules/cross-platform", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Exploit Public-Facing Application", "output": "event.type:creation and event.module:zoom and event.dataset:zoom.webhook and\n  event.action:meeting.created and not zoom.meeting.password:*\n", "source": "detection-rules/cross-platform", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule uses alert data to determine when multiple alerts in different phases of an attack involving the same host are\ntriggered. Analysts can use t...", "output": "signal.rule.name:* and kibana.alert.rule.threat.tactic.id:*\n", "source": "detection-rules/cross-platform", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule uses alert data to determine when multiple different alerts involving the same user are triggered. Analysts\ncan use this to prioritize triag...", "output": "signal.rule.name:* and user.name:* and not user.id:(\"S-1-5-18\" or \"S-1-5-19\" or \"S-1-5-20\")\n", "source": "detection-rules/cross-platform", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Adversaries may modify the standard authentication module for persistence via patching the normal authorization process\nor modifying the login configu...", "output": "event.category:file and event.type:change and\n  (file.name:pam_*.so or file.path:(/etc/pam.d/* or /private/etc/pam.d/* or /usr/lib64/security/*)) and\n  process.executable:\n    (* and\n      not\n      (\n        /usr/libexec/packagekitd or\n        /usr/bin/vim or\n        /usr/libexec/xpcproxy or\n        /usr/bin/bsdtar or\n        /usr/local/bin/brew or\n        \"/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service\"\n      )\n    ) and\n  not file.path:\n         (\n           /tmp/snap.rootfs_*/pam_*.so or\n           /tmp/newroot/lib/*/pam_*.so or\n           /private/var/folders/*/T/com.apple.fileprovider.ArchiveService/TemporaryItems/*/lib/security/pam_*.so or\n           /tmp/newroot/usr/lib64/security/pam_*.so\n         ) and\n  not process.name:\n         (\n           yum or dnf or rsync or platform-python or authconfig or rpm or pdkg or apk or dnf-automatic or btrfs or\n           dpkg or pam-auth-update or steam or platform-python3.6 or pam-config or microdnf or yum_install or yum-cron or\n           systemd or containerd or pacman\n         )\n", "source": "detection-rules/cross-platform", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Event Triggered Execution", "output": "event.category:file and event.type:change and\n  process.name:(* and not (sudo or vim or zsh or env or nano or bash or Terminal or xpcproxy or login or cat or cp or\n  launchctl or java or dnf or tailwatchd or ldconfig or yum or semodule or cpanellogd or dockerd or authselect or chmod or\n  dnf-automatic or git or dpkg or platform-python)) and\n  not process.executable:(/Applications/* or /private/var/folders/* or /usr/local/* or /opt/saltstack/salt/bin/*) and\n  file.path:(/private/etc/rc.local or\n             /etc/rc.local or\n             /home/*/.profile or\n             /home/*/.profile1 or\n             /home/*/.bash_profile or\n             /home/*/.bash_profile1 or\n             /home/*/.bashrc or\n             /Users/*/.bash_profile or\n             /Users/*/.zshenv)\n", "source": "detection-rules/cross-platform", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Account Manipulation", "output": "event.category:file and event.type:(change or creation) and\n file.name:(\"authorized_keys\" or \"authorized_keys2\" or \"/etc/ssh/sshd_config\" or \"/root/.ssh\") and\n not process.executable:\n             (/Library/Developer/CommandLineTools/usr/bin/git or\n              /usr/local/Cellar/maven/*/libexec/bin/mvn or\n              /Library/Java/JavaVirtualMachines/jdk*.jdk/Contents/Home/bin/java or\n              /usr/bin/vim or\n              /usr/local/Cellar/coreutils/*/bin/gcat or\n              /usr/bin/bsdtar or\n              /usr/bin/nautilus or\n              /usr/bin/scp or\n              /usr/bin/touch or\n              /var/lib/docker/* or\n              /usr/bin/google_guest_agent or\n              /opt/jc/bin/jumpcloud-agent or\n              /opt/puppetlabs/puppet/bin/puppet or\n              /usr/bin/chef-client\n)\n", "source": "detection-rules/cross-platform", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Abuse Elevation Control Mechanism", "output": "event.category:process and event.type:start and process.args:(echo and *NOPASSWD*ALL*)\n", "source": "detection-rules/cross-platform", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies the attempted use of a heap-based buffer overflow vulnerability for the Sudo binary in Unix-like systems\n(CVE-2021-3156). Successful exploi...", "output": "event.category:process and event.type:start and\n  process.name:(sudo or sudoedit) and\n  process.args:(*\\\\ and (\"-i\" or \"-s\"))\n", "source": "detection-rules/cross-platform", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule monitors for the usage of the most common clipboard utilities on unix systems by an uncommon process group\nleader. Adversaries may collect d...", "output": "event.category:process and host.os.type:\"linux\" and event.type:\"start\" and\nevent.action:(\"exec\" or \"exec_event\" or \"executed\" or \"process_started\") and\nprocess.name:(\"xclip\" or \"xsel\" or \"wl-clipboard\" or \"clipman\" or \"copyq\") and\nnot process.parent.name:(\"bwrap\" or \"micro\")\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detects the use of the AWS CLI with the `--endpoint-url` argument, which allows users to specify a custom endpoint URL for AWS services. This can be l...", "output": "host.os.type: \"linux\" and event.category: \"process\" and process.name: \"aws\" and process.args:  \"--endpoint-url\"\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Rootkit", "output": "host.os.type:linux and event.category:network and event.action:(connection_attempted or connection_accepted) and\nprocess.name:kworker* and not destination.ip:(\n  10.0.0.0/8 or\n  127.0.0.0/8 or\n  169.254.0.0/16 or\n  172.16.0.0/12 or\n  192.168.0.0/16 or\n  224.0.0.0/4 or\n  \"::1\" or\n  \"FE80::/10\" or\n  \"FF00::/8\" or\n  \"0.0.0.0\"\n) and not destination.port:(\"2049\" or \"111\" or \"892\" or \"597\")\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Application Layer Protocol", "output": "host.os.type:linux and event.category:network and event.action:(connection_attempted or ipv4_connection_attempt_event) and\nprocess.executable : (\n  /etc/crontab or /etc/rc.local or ./* or /boot/* or /dev/shm/* or /etc/cron.*/* or /etc/init.d/* or /etc/rc*.d/* or\n  /etc/update-motd.d/* or /home/*/.* or /tmp/* or /usr/lib/update-notifier/* or /var/log/* or /var/tmp/*\n) and process.name : * and\nnot (\n  process.executable : (\n    /tmp/newroot/* or /tmp/snap.rootfs* or /etc/cron.hourly/BitdefenderRedline or /tmp/go-build* or /srv/snp/docker/* or\n    /run/containerd/* or /tmp/.mount* or /run/k3s/containerd/* or /tmp/selenium* or /tmp/tmp.*/juliainstaller or\n    /tmp/.criu.mntns* or /home/*/.local/share/containers/* or /etc/update-motd.d/*\n  ) or\n  source.ip:(10.0.0.0/8 or 127.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) or\n  process.name : (\n    apt or chrome or curl or dnf or dockerd or dpkg or firefox-bin or git-remote-https or java or kite-update or\n    kited or node or rpm or saml2aws or selenium-manager or solana-validator or wget or yum or ansible* or aws* or\n    php* or pip* or python* or steam* or terraform* or filebeat or apk or cursor or http\n  ) or\n  destination.ip:(\n    0.0.0.0 or 10.0.0.0/8 or 100.64.0.0/10 or 127.0.0.0/8 or 169.254.0.0/16 or 172.16.0.0/12 or 192.0.0.0/24 or\n    192.0.0.0/29 or 192.0.0.10/32 or 192.0.0.170/32 or 192.0.0.171/32 or 192.0.0.8/32 or 192.0.0.9/32 or 192.0.2.0/24 or\n    192.168.0.0/16 or 192.175.48.0/24 or 192.31.196.0/24 or 192.52.193.0/24 or 192.88.99.0/24 or 198.18.0.0/15 or\n    198.51.100.0/24 or 203.0.113.0/24 or 224.0.0.0/4 or 240.0.0.0/4 or \"::1\" or \"FE80::/10\" or \"FF00::/8\"\n  )\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies the use of a compression utility to collect known files containing sensitive information, such as credentials\nand system configurations.\n", "output": "event.category:process and host.os.type:linux and event.type:start and\n  process.name:(zip or tar or gzip or hdiutil or 7z) and\n  process.args:\n    (\n      /root/.ssh/id_rsa or\n      /root/.ssh/id_rsa.pub or\n      /root/.ssh/id_ed25519 or\n      /root/.ssh/id_ed25519.pub or\n      /root/.ssh/authorized_keys or\n      /root/.ssh/authorized_keys2 or\n      /root/.ssh/known_hosts or\n      /root/.bash_history or\n      /etc/hosts or\n      /home/*/.ssh/id_rsa or\n      /home/*/.ssh/id_rsa.pub or\n      /home/*/.ssh/id_ed25519 or\n      /home/*/.ssh/id_ed25519.pub or\n      /home/*/.ssh/authorized_keys or\n      /home/*/.ssh/authorized_keys2 or\n      /home/*/.ssh/known_hosts or\n      /home/*/.bash_history or\n      /root/.aws/credentials or\n      /root/.aws/config or\n      /home/*/.aws/credentials or\n      /home/*/.aws/config or\n      /root/.docker/config.json or\n      /home/*/.docker/config.json or\n      /etc/group or\n      /etc/passwd or\n      /etc/shadow or\n      /etc/gshadow\n    )\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Identifies file permission modifications in common writable directories by a non-root user. Adversaries often drop files\nor payloads into a writable d...", "output": "host.os.type:linux and event.category:process and event.type:start and\nprocess.name:(chattr or chgrp or chmod or chown) and process.working_directory:(/dev/shm or /tmp or /var/tmp) and\nnot process.parent.name:(\n  apt-key or update-motd-updates-available or apt-get or java or pilot or PassengerAgent or nginx\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects interactive shells launched from system users. System users typically do not require interactive shells,\nand their presence may indi...", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and user.name:(\n   daemon or bin or sys or sync or games or man or mail or news or uucp or proxy or backup or list or irc\n   or gnats or _apt or Debian-exim or systemd-timesync or messagebus or uuidd or _chrony or sshd or\n   gamer or shutdown or halt or dbus or polkitd or rtkit or pipewire or tcpdump or clevis or\n   libstoreagemgmt or geoclue or tss or sssd or gnome-initial-setup or pesign or dnsmasq or chrony\n) and process.interactive:true and process.parent.executable:* and not (\n  process.parent.name:(\n    apt-key or apt-config or gpgv or gpgconf or man-db.postinst or sendmail or rpm or nullmailer-inject\n  ) or\n  process.args:(/etc/apt/trusted.gpg.d/* or /tmp/apt-key-gpg*) or\n  process.name:(awk or apt-config or dpkg or grep or gpgv or sed) or\n  (user.name:_apt and process.name:(sqv or apt-key or gpgconf or sort or mktemp or find or cmp or gpg-connect-agent)) or\n  (user.name:man and process.name:mandb) or\n  (user.name:daemon and process.name:at)\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Hide Artifacts", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and\nprocess.name:(kill or pkill or killall) and not (\n  process.args:(\"-HUP\" or \"-SIGUSR1\" or \"-USR2\" or \"-WINCH\" or \"-USR1\") or\n  process.parent.command_line:\"runc init\"\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects the use of the LD_PRELOAD and LD_LIBRARY_PATH environment variables in a command line argument.\nThis behavior is unusual and may ind...", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and\nprocess.parent.name:(* and not (\n  awk or bwrap or cylancesvc or dbus-run-session or java or julia or make or matlab_helper or ninja or noproc_sandbox or\n  nxrunner or nxserver or perl or rear or sapcontrol or setsid or spoold or sshd or steam or su or sudo or titanagent or\n  vls_agent or zabbix_agentd\n)) and\nprocess.name:(bash or csh or dash or fish or ksh or sh or tcsh or zsh) and\nprocess.args:-c and process.command_line:(*LD_LIBRARY_PATH=* or *LD_PRELOAD=*)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects the creation of a symbolic link from a system binary to a suspicious and writable location. This\nactivity may indicate an attacker's...", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.parent.executable:* and\n(process.name:ln or process.name:busybox and process.args:ln or process.name:cp and process.args:--symbolic-link) and\nprocess.args:(\n  (\n    /bin/* or /lib/* or /lib64/* or /sbin/* or /usr/bin/* or /usr/lib/* or /usr/lib64/* or /usr/local/bin/* or\n    /usr/local/lib/* or /usr/local/lib64/* or /usr/local/sbin/* or /usr/sbin/*\n  ) and (\n    /*/.* or /dev/shm/* or /home/* or /root/* or /tmp/* or /var/tmp/*\n  ) and\n  not (/usr/bin/coreutils or /tmp/mkinitcpio* or /var/tmp/dracut* or /var/tmp/mkinitramfs*)\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Hijack Execution Flow", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and process.env_vars:*\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule detects the creation of files in the /var/log/ directory via process executables located in world-writeable\nlocations or via hidden processe...", "output": "event.category:file and host.os.type:linux and event.action:(creation or file_create_event or file_rename_event or rename) and\n(process.executable:(/tmp/* or /var/tmp/* or /dev/shm/* or ./* or /boot/*) or process.name:.*) and\nfile.path:/var/log/* and not file.extension:*\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Loadable Kernel Modules (or LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. They\nextend the functionality of the...", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:(exec or exec_event) and (\n (process.name:(lsmod or modinfo)) or\n (process.name:kmod and process.args:list) or\n (process.name:depmod and process.args:(--all or -a))\n) and\nnot (\n  process.parent.name:(\n    mkinitramfs or cryptroot or framebuffer or dracut or jem or thin-provisioning-tools or readykernel or lvm2 or\n    vz-start or iscsi or mdadm or ovalprobes or bcache or plymouth or dkms or overlayroot or weak-modules or zfs or\n    systemd or whoopsie-upload-all or kdumpctl or apport-gtk or casper or rear or kernel-install or newrelic-infra\n  ) or\n  process.parent.executable:/var/lib/dpkg/info/linux-modules*-generic.post*\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This threshold rule monitors for the rapid execution of unix utilities that are capable of conducting network scans.\nAdversaries may leverage built-in...", "output": "event.category:process and host.os.type:linux and event.action:(exec or exec_event or executed or process_started) and\nevent.type:start and process.name:(ping or nping or hping or hping2 or hping3 or nc or ncat or netcat or socat)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: System Information Discovery", "output": "event.category:process and host.os.type:linux and event.type:(start or process_started) and\n  process.args:(\"/sys/class/dmi/id/bios_version\" or\n                \"/sys/class/dmi/id/product_name\" or\n                \"/sys/class/dmi/id/chassis_vendor\" or\n                \"/proc/scsi/scsi\" or\n                \"/proc/ide/hd0/model\") and\n  not user.name:root\n", "source": "detection-rules/linux", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Native API", "output": "host.os.type:linux and event.category:file and event.action:(creation or file_create_event) and\nfile.extension:(pid or lock or reboot) and file.path:(/var/run/* or /run/*) and (\n  (process.name : (\n    bash or dash or sh or tcsh or csh or zsh or ksh or fish or ash or touch or nano or vim or vi or editor or mv or cp)\n  ) or (\n  process.executable : (\n    ./* or /tmp/* or /var/tmp/* or /dev/shm/* or /var/run/* or /boot/* or /srv/* or /run/*\n  ))\n) and not (\n  process.executable : (\n  /tmp/newroot/* or /run/containerd/* or /run/k3s/containerd/* or /run/k0s/container* or /snap/* or /vz/* or\n  /var/lib/docker/* or /etc/*/universal-hooks/pkgs/mysql-community-server/* or /var/lib/snapd/* or /etc/rubrik/* or\n  /run/udev/data/*\n  ) or\n  process.name : (\n    go or git or containerd* or snap-confine or cron or crond or sshd or unattended-upgrade or vzctl or ifup or\n    rpcbind or runc or gitlab-runner-helper or elastic-agent or metricbeat or redis-server or libvirt_leaseshelper or\n    s6-ipcserver-socketbinder or xinetd or libvirtd or veeamdeploymentsvc  or dnsmasq or virtlogd or lynis or\n    veeamtransport\n  ) or\n  file.name : (\n    jem.*.pid or lynis.pid or redis.pid or yum.pid or MFS.pid or jenkins.pid or nvmupdate.pid or openlitespeed.pid or\n    rhnsd.pid\n  ) or\n  file.path : (/run/containerd/* or /var/run/docker/containerd/* or /var/run/jem*.pid)\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Command and Scripting Interpreter", "output": "host.os.type:\"linux\" and event.dataset:\"system.syslog\" and process.name:\"kernel\" and\nmessage:\"started with executable stack\"\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies when a terminal (tty) is spawned via Perl. Attackers may upgrade a simple reverse shell to a fully\ninteractive tty after obtaining initial ...", "output": "event.category:process and host.os.type:linux and event.type:(start or process_started) and process.name:perl and\n  process.args:(\"exec \\\"/bin/sh\\\";\" or \"exec \\\"/bin/dash\\\";\" or \"exec \\\"/bin/bash\\\";\")\n", "source": "detection-rules/linux", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule leverages the new_terms rule type to identify the creation of a potentially unsafe docker container from an\nunusual parent process. Attacker...", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.name:docker and\nprocess.args:(run and --privileged)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Command and Scripting Interpreter", "output": "event.category:process and host.os.type:linux and event.type:start and\nevent.action:(ProcessRollup2 or exec or exec_event or start) and\nprocess.name:(bash or csh or dash or fish or ksh or sh or tcsh or zsh) and\nprocess.args:(-c and *&)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule monitors for the execution of several commonly used system commands executed by a previously unknown\nexecutable located in commonly abused d...", "output": "host.os.type:linux and event.category:process and event.action:(exec or exec_event or fork or fork_event) and\nprocess.executable:(* and (\n  /etc/crontab or /bin/* or /boot/* or /dev/shm/* or /etc/cron.*/* or /etc/init.d/* or /etc/rc*.d/* or /etc/update-motd.d/* or\n  /home/*/.* or /tmp/* or /usr/bin/* or /usr/lib/update-notifier/* or /usr/share/* or /var/tmp/*\n) and not /tmp/go-build*) and\nprocess.args:(hostname or id or ifconfig or ls or netstat or ps or pwd or route or top or uptime or whoami) and\nnot (process.name:\n  (apt or dnf or docker or dockerd or dpkg or hostname or id or ls or netstat or ps or pwd or rpm or snap or\n  snapd or sudo or top or uptime or which or whoami or yum) or\nprocess.parent.executable:(\n  /opt/cassandra/bin/cassandra or /opt/nessus/sbin/nessusd or /opt/nessus_agent/sbin/nessus-agent-module or /opt/puppetlabs/puppet/bin/puppet or\n  /opt/puppetlabs/puppet/bin/ruby or /usr/libexec/platform-python or /usr/local/cloudamize/bin/CCAgent or /usr/sbin/sshd or /bin/* or\n  /etc/network/* or /opt/Elastic/* or /opt/TrendMicro* or /opt/aws/* or /opt/eset/* or /opt/rapid7/* or /run/containerd/* or /run/k3s/* or\n  /snap/* or /tmp/dpkg-licenses* or /tmp/newroot/* or /usr/bin/* or /var/lib/amagent/* or /var/lib/docker/* or /vz/*\n  ) or\n  process.executable:(/run/containerd/* or /srv/snp/docker/* or /tmp/.criu*)\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Command and Scripting Interpreter", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.name:mkfifo and\nprocess.parent.name:(bash or csh or dash or fish or ksh or sh or tcsh or zsh) and\nprocess.args:((/dev/shm/* or /tmp/* or /var/tmp/*) and not /*fifo*)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Monitors for the execution of a previously unknown unix binary with read, write and execute memory region permissions.\nThe mprotect() system call is u...", "output": "event.category:process and host.os.type:linux and auditd.data.syscall:mprotect and auditd.data.a2:7 and not (\n  process.executable:(\n    \"/usr/share/kibana/node/bin/node\" or \"/usr/share/elasticsearch/jdk/bin/java\" or \"/usr/sbin/apache2\"\n  ) or\n  process.name:(httpd or java)\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Command and Scripting Interpreter", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and\nprocess.entry_leader.entry_meta.type:container and process.interactive:true\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "This rule detects suspicious child process from the kernel thread (kthreadd) parent process. Attackers may execute payloads from\nkernel space via kthr...", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.parent.name:kthreadd and (\n  process.executable:(/dev/shm/* or /tmp/* or /var/tmp/* or /var/www/*) or\n  process.name:(bash or csh or curl or dash or fish or id or ksh or nohup or setsid or sh or tcsh or wget or whoami or zsh)\n) and\nprocess.command_line:(\n  */dev/shm/* or */dev/tcp/* or */etc/init.d* or */etc/ld.so* or */etc/profile* or */etc/rc.local* or */etc/shadow* or */etc/ssh* or\n  */etc/sudoers* or */home/*/.ssh/* or */root/.ssh* or */tmp/* or */var/log/* or */var/run/* or */var/tmp/* or */var/www/* or\n  *base64* or *cron* or *xxd* or *~/.ssh/*\n) and not (\n  process.name:(true or cifs.upcall or dpkg or flock or gdbus or getopt or grep or mount or touch or umount or uname) or\n  process.command_line:(\n    \"sh -c /bin/true\" or */bin/ps* or */usr/bin/find* or */usr/bin/grep* or *ds_agent* or *gitlabrunner* or *nagios* or\n    *omsagent* or *pgrep*\n  ) or\n  process.executable:(\n    /lib/systemd/systemd-cgroups-agent or /proc/self/exe or /usr/local/axs-haproxy-monitoring/haproxy_stats.sh or /tmp/newroot/* or\n    /var/lib/docker/overlay2/* or /vz/root/*\n  )\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects the execution of a PATH variable in a command line invocation by a shell process. This behavior\nis unusual and may indicate an attem...", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and\nprocess.name:(bash or csh or dash or fish or ksh or sh or tcsh or zsh) and process.args:-c and\nprocess.command_line:*PATH=* and\nnot (\n  process.command_line:(*_PATH=* or *PYTHONPATH=* or sh*/run/motd.dynamic.new) or\n  process.parent.executable:(\n    \"/opt/puppetlabs/puppet/bin/puppet\" or /var/lib/docker/overlay2/* or /vz/root/*/dovecot or\n    \"/usr/libexec/dovecot/auth\" or /home/*/.local/share/containers/* or /vz/root/*/dovecot/auth\n  ) or\n  process.parent.command_line:\"runc init\"\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects the execution of the `pkexec` command by a shell process. The `pkexec` command is used to execute\nprograms as another user, typicall...", "output": "event.category:process and host.os.type:linux and event.type:start and\nevent.action:(exec or exec_event or start or ProcessRollup2) and process.name:pkexec and\nprocess.args:pkexec and process.parent.name:(bash or dash or sh or tcsh or csh or zsh or ksh or fish)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "This rule identifies a high number (10) of process terminations via pkill from the same host within a short time period.\n", "output": "event.category:process and host.os.type:linux and event.type:start and process.name:\"pkill\" and process.args:\"-f\"\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "This rule leverages the new_terms rule type to detect successful SSH authentications via a public\nkey that has not been seen in the last 10 days. Publ...", "output": "event.category:authentication and host.os.type:linux and event.action:ssh_login and event.outcome:success and system.auth.ssh.method:publickey\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "This rule leverages the new_terms rule type to detect successful SSH authentications by an IP-\naddress that has not been authenticated in the last 10 ...", "output": "event.category:authentication and host.os.type:linux and event.action:ssh_login and event.outcome:success\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule leverages the new_terms rule type to detect successful SSH authentications by a user\nwho has not been authenticated in the last 10 days. Thi...", "output": "event.category:authentication and host.os.type:linux and event.action:ssh_login and event.outcome:success\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "This rule leverages the new_terms rule type to detect file creation via a commonly used file\ntransfer service while excluding typical remote file crea...", "output": "event.category:file and host.os.type:linux and event.action:creation and\nprocess.name:(scp or ftp or sftp or vsftpd or sftp-server or sync) and\nnot (\n  file.path:(\n    /dev/ptmx or /run/* or /var/run/* or /home/*/.ansible/*AnsiballZ_*.py or /home/*/.ansible/tmp/ansible-tmp* or\n    /root/.ansible/*AnsiballZ_*.py or /tmp/ansible-chief/ansible-tmp*AnsiballZ_*.py or\n    /tmp/newroot/home/*/.ansible/tmp/ansible-tmp*AnsiballZ_*.py or /tmp/.ansible/tmp/ansible-tmp*AnsiballZ_*.py or\n    /tmp/ansible-tmp-*/AnsiballZ_*.py or /tmp/.ansible/ansible-tmp-*AnsiballZ_*.py\n  ) or\n  file.extension:(filepart or yaml or new or rpm or deb)\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule monitors the syslog log file for messages related to instances of a program using the `bpf_probe_write_user` helper.\nThe `bpf_probe_write_us...", "output": "host.os.type:linux and event.dataset:\"system.syslog\" and process.name:kernel and message:\"bpf_probe_write_user\"\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Adversaries may modify SSH related binaries for persistence or credential access by patching sensitive functions to\nenable unauthorized access or by l...", "output": "event.category:file and host.os.type:linux and event.type:change and\n  process.name:(* and not (\n    dnf or dnf-automatic or dpkg or yum or rpm or yum-cron or anacron or platform-python* or\n    apk or ansible-admin or systemd or python* or yum or nix-daemon or nix\n    )\n  ) and \n  (file.path:(/usr/bin/scp or \n                /usr/bin/sftp or \n                /usr/bin/ssh or \n                /usr/sbin/sshd) or \n  file.name:libkeyutils.so) and\n  not process.executable:/usr/share/elasticsearch/*\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Create or Modify System Process", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.name:dpkg and\nprocess.args:(\"-i\" or \"--install\")\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Boot or Logon Autostart Execution", "output": "event.category:file and host.os.type:linux and event.type:creation and file.extension:ko and not (\n  file.path:/var/tmp/mkinitramfs_* or process.executable:/snap/* or process.name:cpio\n) and not file.path:/tmp/mkinitramfs*\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule monitors the syslog log file for error messages related to the rc.local process. The rc.local file is a script\nthat is executed during the b...", "output": "host.os.type:linux and event.dataset:system.syslog and process.name:rc.local and\nmessage:(\"Connection refused\" or \"No such file or directory\" or \"command not found\")\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "This rule leverages the new_terms rule type to identify the installation of RPM packages by an unusual parent process.\nRPM is a package management sys...", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.name:rpm and\nprocess.args:(\"-i\" or \"--install\")\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule monitors the creation of shared object files by previously unknown processes. The creation of a shared object\nfile involves compiling code i...", "output": "host.os.type:\"linux\" and event.action:(\"creation\" or \"file_create_event\" or \"file_rename_event\" or \"rename\" or \"file_write_event\") and\n(file.extension:\"so\" or file.name:*.so.*) and\nfile.path:(\n  /dev/shm/* or /usr/lib/* or /usr/lib64/* or /usr/local/lib/* or /usr/local/lib64/* or /lib/x86_64-linux-gnu/* or\n  /usr/lib/x86_64-linux-gnu/* or /lib/i386-linux-gnu/* or /usr/lib/i386-linux-gnu/* or /lib/* or /lib64/*\n) and not (\n  process.name:(\n    \"dockerd\" or \"dpkg\" or \"rpm\" or \"snapd\" or \"yum\" or \"vmis-launcher\" or \"pacman\" or \"apt-get\" or \"dnf\" or \"podman\" or\n    platform-python* or \"dnf-automatic\" or \"unattended-upgrade\" or \"apk\" or \"snap-update-ns\" or \"install\" or \"exe\" or\n    \"systemd\" or \"root\" or \"sshd\" or \"pip\" or \"jlink\" or python* or \"update-alternatives\" or pip* or \"crio\" or \"packagekitd\"\n  ) or \n  (process.name:\"vmware-install.pl\" and file.path:/usr/lib/vmware-tools/*) or\n  (process.name:\"ssm-agent-worker\" and file.path:/usr/lib/jvm/java*) or \n  process.executable : (/dev/fd/* or \"/\" or \"/kaniko/executor\" or \"/usr/bin/buildah\")\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Create or Modify System Process", "output": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and\nprocess.executable:/usr/bin/systemctl and process.args:(enable or reenable or start) and \nprocess.entry_leader.entry_meta.type:* and\nnot (\n  process.entry_leader.entry_meta.type:(container or init or unknown) or\n  process.parent.pid:1 or\n  process.parent.executable:(\n    /bin/adduser or /bin/dnf or /bin/dnf-automatic or /bin/dockerd or /bin/dpkg or /bin/microdnf or /bin/pacman or\n    /bin/podman or /bin/rpm or /bin/snapd or /bin/sudo or /bin/useradd or /bin/yum or /usr/bin/dnf or\n    /usr/bin/dnf-automatic or /usr/bin/dockerd or /usr/bin/dpkg or /usr/bin/microdnf or /usr/bin/pacman or\n    /usr/bin/podman or /usr/bin/rpm or /usr/bin/snapd or /usr/bin/sudo or /usr/bin/yum or /usr/sbin/adduser or\n    /usr/sbin/invoke-rc.d or /usr/sbin/useradd or /var/lib/dpkg/*\n  ) or\n  process.args_count >= 5\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Boot or Logon Autostart Execution", "output": "host.os.type:linux and event.dataset:\"system.syslog\" and process.name:kernel and\nmessage:\"module verification failed: signature and/or required key missing - tainting kernel\"\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Boot or Logon Autostart Execution", "output": "host.os.type:linux and event.dataset:\"system.syslog\" and process.name:kernel and\nmessage:\"loading out-of-tree module taints kernel.\"\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects the execution of unusual commands via a descendant process of exim4. Attackers may use descendant\nprocesses of exim4 to evade detect...", "output": "host.os.type:linux and event.type:start and event.action:exec and process.parent.name:exim4 and\nnot process.name:(\n  exim4 or start-stop-daemon or run-parts or systemctl or update-exim4.conf or install or plymouth or\n  readlink or grep or stat or cmake or gcc or cppcheck or sort or sshd\n)\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects successful authentications via PAM grantors that are not commonly used. This could indicate an\nattacker is attempting to escalate pr...", "output": "event.category:authentication and host.os.type:linux and event.action:authenticated and event.outcome:success and\nauditd.data.grantors:(* and not (pam_rootok or *pam_cap* or *pam_permit*))\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Event Triggered Execution", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and\nprocess.parent.name:(ssh or sshd) and process.args_count:2 and\nnot (\n  process.command_line:(-bash or -zsh or -sh) or\n  process.name:(ractrans or exectask or tty or tput or ferny-askpass or id or ip)\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies potential privilege escalation exploitation of DAC (Discretionary access control) file permissions. The rule\nidentifies exploitation of DAC...", "output": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and\n(process.thread.capabilities.permitted:CAP_DAC_* or process.thread.capabilities.effective: CAP_DAC_*) and\nprocess.command_line:(*sudoers* or *passwd* or *shadow* or */root/.ssh*) and not (\n  user.id : \"0\" or\n  process.name : (\n    \"tar\" or \"getent\" or \"su\" or \"stat\" or \"dirname\" or \"chown\" or \"sudo\" or \"dpkg-split\" or \"dpkg-deb\" or \"dpkg\" or\n    \"podman\" or \"awk\" or \"passwd\" or \"dpkg-maintscript-helper\" or \"mutt_dotlock\" or \"nscd\" or \"logger\" or \"gpasswd\"\n  ) or\n  process.executable : /usr/lib/*/lxc/rootfs/* or\n  process.parent.name : (\n    \"dpkg\" or \"java\" or *postinst or \"dpkg-preconfigure\" or \"gnome-shell\"\n  )\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies modification of the dynamic linker preload shared object (ld.so.preload). Adversaries may execute malicious\npayloads by hijacking the dynam...", "output": "host.os.type:linux and event.category:file and event.action:(file_rename_event or rename or renamed or updated) and\nnot event.type:deletion and file.path:/etc/ld.so.preload and\nprocess.name:(* and not (oneagentinstallaction or passwd or wine))\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detects potential buffer overflow attacks by querying the \"Segfault Detected\" pre-built rule signal index, through a\nthreshold rule, with a minimum nu...", "output": "kibana.alert.rule.rule_id:\"5c81fc9d-1eae-437f-ba07-268472967013\" and host.os.type:linux and event.kind:signal\n", "source": "detection-rules/linux", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies access to the /etc/shadow file via the commandline using standard system utilities. After elevating\nprivileges to root, threat actors may a...", "output": "host.os.type : \"linux\" and event.category : \"process\" and event.action : (\"exec\" or \"exec_event\") and\n(process.args : \"/etc/shadow\" or (process.working_directory: \"/etc\" and process.args: \"shadow\")) and not (\n  (process.executable : (\"/bin/chown\" or \"/usr/bin/chown\") and process.args : \"root:shadow\") or\n  (process.executable : (\"/bin/chmod\" or \"/usr/bin/chmod\") and process.args : \"640\") or\n  process.executable:(/vz/* or /var/lib/docker/* or /run/containerd/* or /tmp/.criu* or /tmp/newroot/*) or\n  process.parent.name:(gen_passwd_sets or scc_* or wazuh-modulesd)\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Monitors for the elevation of regular user permissions to root permissions through a previously unknown executable.\nAttackers may attempt to evade det...", "output": "host.os.type:\"linux\" and event.category:\"process\" and event.action:\"uid_change\" and event.type:\"change\" and user.id:\"0\"\nand process.parent.name:(\"bash\" or \"dash\" or \"sh\" or \"tcsh\" or \"csh\" or \"zsh\" or \"ksh\" or \"fish\") and not (\n  process.executable:(\n    /bin/* or /usr/bin/* or /sbin/* or /usr/sbin/* or /snap/* or /tmp/newroot/* or /var/lib/docker/* or /usr/local/* or\n    /opt/psa/admin/* or /usr/lib/snapd/snap-confine or /opt/dynatrace/* or /opt/microsoft/* or\n    /var/lib/snapd/snap/bin/node or /opt/gitlab/embedded/sbin/logrotate or /etc/apt/universal-hooks/* or\n    /opt/puppetlabs/puppet/bin/puppet or /opt/cisco/* or /run/k3s/containerd/* or /usr/lib/postfix/sbin/master or\n    /usr/libexec/postfix/local or /var/lib/snapd/snap/bin/postgresql* or /opt/puppetlabs/puppet/bin/ruby\n  ) or\n  process.name:(\n    \"bash\" or \"dash\" or \"sh\" or \"tcsh\" or \"csh\" or \"zsh\" or \"ksh\" or \"fish\" or \"sudo\" or \"su\" or \"apt\" or \"apt-get\" or\n    \"aptitude\" or \"squid\" or \"snap\" or \"fusermount\" or \"pkexec\" or \"umount\" or \"master\" or \"omsbaseline\" or \"dzdo\" or\n    \"sandfly\" or \"logrotate\" or \"nix-installer\" \n  ) or\n  process.args:/usr/bin/python*\n)\n", "source": "detection-rules/linux", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule monitors for the unusual occurrence of outbound network connections to suspicious top level domains.\n", "output": "event.category : \"network\" and host.os.type : \"macos\" and event.type : \"start\" and\ndestination.domain : (*.team or *.lol or *.kr or *.ke or *.nu or *.space or \n                          *.capital or *.in or *.cfd or *.online or *.ru or \n                          *.info or *.top or *.buzz or *.xyz or *.rest or \n                          *.ml or *.cf or *.gq or *.ga or *.onion or \n                          *.network or *.monster or *.marketing or *.cyou or \n                          *.quest or *.cc or *.bar or *.click or *.cam or \n                          *.surf or *.tk or *.shop or *.club or *.icu or \n                          *.pw or *.ws or *.hair or *.mom or \n                          *.beauty or *.boats or *.fun or *.life or \n                          *.store)\n", "source": "detection-rules/macos", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule monitors for the unusual occurrence of outbound network connections to suspicious webservice domains.\n", "output": "event.category : \"network\" and host.os.type : \"macos\" and event.type : \"start\" and\ndestination.domain : (\n    pastebin.* or\n    paste.ee or\n    ghostbin.com or\n    drive.google.com or\n    ?.docs.live.net or\n    api.dropboxapi.* or\n    content.dropboxapi.* or\n    *dl.dropboxusercontent.* or\n    api.onedrive.com or\n    *.onedrive.org or\n    onedrive.live.com or\n    filebin.net or\n    *.ngrok.io or\n    ngrok.com or\n    *.portmap.* or\n    *serveo.net or\n    *localtunnel.me or\n    *pagekite.me or\n    *localxpose.io or\n    *notabug.org or\n    rawcdn.githack.* or\n    paste.nrecom.net or\n    zerobin.net or\n    controlc.com or\n    requestbin.net or\n    api.slack.com or\n    slack-redir.net or\n    slack-files.com or\n    cdn.discordapp.com or\n    discordapp.com or\n    discord.com or\n    apis.azureedge.net or\n    cdn.sql.gg or\n    ?.top4top.io or\n    top4top.io or\n    uplooder.net or\n    *.cdnmegafiles.com or\n    transfer.sh or\n    updates.peer2profit.com or\n    api.telegram.org or\n    t.me or\n    meacz.gq or\n    rwrd.org or\n    *.publicvm.com or\n    *.blogspot.com or\n    api.mylnikov.org or\n    script.google.com or\n    script.googleusercontent.com or\n    paste4btc.com or\n    workupload.com or\n    temp.sh or\n    filetransfer.io or\n    gofile.io or\n    store?.gofile.io or\n    tiny.one or\n    api.notion.com or\n    *.sharepoint.com or\n    *upload.ee or\n    bit.ly or\n    t.ly or\n    cutt.ly or\n    mbasic.facebook.com or\n    api.gofile.io or\n    file.io or\n    api.anonfiles.com or\n    api.trello.com or\n    gist.githubusercontent.com or\n    dpaste.com or\n    *azurewebsites.net or\n    *.zulipchat.com or\n    *.4shared.com or\n    filecloud.me or\n    i.ibb.co or\n    files.catbox.moe or\n    *.getmyip.com or\n    mockbin.org or\n    webhook.site or\n    run.mocky.io or\n    *infinityfreeapp.com or\n    free.keep.sh or\n    tinyurl.com or\n    ftpupload.net or\n    lobfile.com or\n    *.ngrok-free.app or\n    myexternalip.com or\n    yandex.ru or\n    *.yandex.ru or\n    *.aternos.me or\n    cdn??.space or\n    *.pcloud.com or\n    mediafire.zip or\n    urlz.fr or\n    rentry.co or\n    *.b-cdn.net or\n    pastecode.dev or\n    i.imgur.com or\n    the.earth.li or\n    *.trycloudflare.com\n) and \nnot (destination.domain : (*.sharepoint.com or *.azurewebsites.net or \"onedrive.live.com\" or *.b-cdn.net or api.onedrive.com or \"drive.google.com\" or *.blogspot.com) and process.code_signature.subject_name:(*Microsoft* or \"Software Signing\" or \"Apple Mac OS Application Signing\" or *VMware*) and process.code_signature.trusted:true) and \nnot (process.code_signature.subject_name:(*Mozilla* or *Google* or *Brave* or *Opera* or \"Software Signing\" or *Zscaler* or *Browser*) and process.code_signature.trusted:true)  and \nnot (destination.domain :(\"discord.com\" or cdn.discordapp.com or \"content.dropboxapi.com\" or \"dl.dropboxusercontent.com\") and process.code_signature.subject_name :(*Discord* or *Dropbox*) and process.code_signature.trusted:true)\n", "source": "detection-rules/macos", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Brute Force", "output": "event.category:process and host.os.type:macos and event.type:start and process.name:\"sshd-keygen-wrapper\" and process.parent.name:launchd\n", "source": "detection-rules/macos", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies the creation or modification of the login window property list (plist). Adversaries may modify plist files to\nrun a program during system b...", "output": "event.category:file and host.os.type:macos and not event.type:\"deletion\" and\n file.name:\"com.apple.loginwindow.plist\" and\n not process.name: (systemmigrationd or DesktopServicesHelper or diskmanagementd or rsync or launchd or cfprefsd or xpcproxy or ManagedClient or MCXCompositor or backupd or \"iMazing Profile Editor\" or storagekitd or CloneKitService)\n", "source": "detection-rules/macos", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule detects network events that may indicate the use of Telnet traffic. Telnet is commonly used by system\nadministrators to remotely control old...", "output": "(event.dataset:network_traffic.flow or event.category:(network or network_traffic))\n    and event.type:connection and not event.action:(\n        flow_dropped or flow_denied or denied or deny or\n        flow_terminated or timeout or Reject or network_flow)\n    and destination.port:23\n", "source": "detection-rules/network", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects the use of the default Cobalt Strike Team Server TLS certificate. Cobalt Strike is software for\nAdversary Simulations and Red Team O...", "output": "(event.dataset: network_traffic.tls or event.category: (network or network_traffic))\n  and (tls.server.hash.md5:950098276A495286EB2A2556FBAB6D83\n  or tls.server.hash.sha1:6ECE5ECE4192683D2D84E25B0BA7E04F9CB7EB7C\n  or tls.server.hash.sha256:87F2085C32B6A2CC709B365F55873E207A9CAA10BFFECF2FD16D3CF9D94D390C)\n", "source": "detection-rules/network", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Detects a Roshal Archive (RAR) file or PowerShell script downloaded from the internet by an internal host. Gaining\ninitial access to a system and then...", "output": "(event.dataset: (network_traffic.http or network_traffic.tls) or\n  (event.category: (network or network_traffic) and network.protocol: http)) and\n  (url.extension:(ps1 or rar) or url.path:(*.ps1 or *.rar)) and\n    not destination.ip:(\n      10.0.0.0/8 or\n      127.0.0.0/8 or\n      169.254.0.0/16 or\n      172.16.0.0/12 or\n      192.0.0.0/24 or\n      192.0.0.0/29 or\n      192.0.0.8/32 or\n      192.0.0.9/32 or\n      192.0.0.10/32 or\n      192.0.0.170/32 or\n      192.0.0.171/32 or\n      192.0.2.0/24 or\n      192.31.196.0/24 or\n      192.52.193.0/24 or\n      192.168.0.0/16 or\n      192.88.99.0/24 or\n      224.0.0.0/4 or\n      100.64.0.0/10 or\n      192.175.48.0/24 or\n      198.18.0.0/15 or\n      198.51.100.0/24 or\n      203.0.113.0/24 or\n      240.0.0.0/4 or\n      \"::1\" or\n      \"FE80::/10\" or\n      \"FF00::/8\"\n    ) and\n    source.ip:(\n      10.0.0.0/8 or\n      172.16.0.0/12 or\n      192.168.0.0/16\n    )\n", "source": "detection-rules/network", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects events that could be describing IPSEC NAT Traversal traffic. IPSEC is a VPN technology that allows one\nsystem to talk to another usi...", "output": "(event.dataset: network_traffic.flow or (event.category: (network or network_traffic))) and network.transport:udp and destination.port:4500\n", "source": "detection-rules/network", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Exfiltration Over Alternative Protocol", "output": "(event.dataset: (network_traffic.flow or zeek.smtp) or event.category:(network or network_traffic)) and network.transport:tcp and destination.port:26\n", "source": "detection-rules/network", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule detects network events that may indicate the use of RDP traffic from the Internet. RDP is commonly used by\nsystem administrators to remotely...", "output": "(event.dataset: network_traffic.flow or (event.category: (network or network_traffic))) and\n  network.transport:tcp and (destination.port:3389 or event.dataset:zeek.rdp) and\n  not source.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  ) and\n  destination.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  )\n", "source": "detection-rules/network", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule detects network events that may indicate the use of VNC traffic from the Internet. VNC is commonly used by\nsystem administrators to remotely...", "output": "(event.dataset: network_traffic.flow or (event.category: (network or network_traffic))) and\n  network.transport:tcp and destination.port >= 5800 and destination.port <= 5810 and\n  not source.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  ) and\n  destination.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  )\n", "source": "detection-rules/network", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Remote Access Tools", "output": "(event.dataset: network_traffic.flow  or (event.category: (network or network_traffic))) and\n  network.transport:tcp and destination.port >= 5800 and destination.port <= 5810 and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/network", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule identifies a potential network sweep. A network sweep is a method used by attackers to scan a target network,\nidentifying active hosts, open...", "output": "event.action:network_flow and destination.port:(21 or 22 or 23 or 25 or 139 or 445 or 3389 or 5985 or 5986) and\nsource.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)\n", "source": "detection-rules/network", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule identifies a potential port scan. A port scan is a method utilized by attackers to systematically scan a\ntarget system or network for open p...", "output": "event.action:network_flow and destination.port:* and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)\n", "source": "detection-rules/network", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule identifies a potential SYN-Based port scan. A SYN port scan is a technique employed by attackers to scan a\ntarget network for open ports by ...", "output": "event.action:network_flow and destination.port:* and network.packets <= 2 and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)\n", "source": "detection-rules/network", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects network events that may indicate the use of RPC traffic from the Internet. RPC is commonly used by\nsystem administrators to remotely...", "output": "(event.dataset: network_traffic.flow or (event.category: (network or network_traffic))) and\n  network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and\n  not source.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  ) and\n  destination.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  )\n", "source": "detection-rules/network", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Exploit Public-Facing Application", "output": "(event.dataset: network_traffic.flow or (event.category: (network or network_traffic))) and\n  network.transport:tcp and (destination.port:135 or event.dataset:zeek.dce_rpc) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/network", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "This rule detects network events that may indicate the use of Windows file sharing (also called SMB or CIFS) traffic to\nthe Internet. SMB is commonly ...", "output": "(event.dataset: network_traffic.flow or (event.category: (network or network_traffic))) and\n  network.transport:tcp and (destination.port:(139 or 445) or event.dataset:zeek.smb) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/network", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Specially crafted DNS requests can manipulate a known overflow vulnerability in some Windows DNS servers, resulting in\nRemote Code Execution (RCE) or ...", "output": "(event.dataset: network_traffic.dns or (event.category: (network or network_traffic) and destination.port: 53)) and\n  (event.dataset:zeek.dns or type:dns or event.type:connection) and network.bytes > 60000\n", "source": "detection-rules/network", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Elastic Endgame detected Credential Dumping. Click the Elastic Endgame icon in the event.module column or the link in\nthe rule.reference column for ad...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:cred_theft_event or endgame.event_subtype_full:cred_theft_event)\n", "source": "detection-rules/promotions", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to OS Credential Dumping", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:cred_theft_event or endgame.event_subtype_full:cred_theft_event)\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Generates a detection alert for each CrowdStrike alert written to the configured indices. Enabling this rule allows you\nto immediately begin investiga...", "output": "event.kind: alert and data_stream.dataset: crowdstrike.alert\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generates a detection alert for each Elastic Security alert written to the configured indices. Enabling this rule allows\nyou to immediately begin inve...", "output": "event.kind: alert and data_stream.dataset: elastic_security.alert\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Elastic Endgame detected an Adversary Behavior. Click the Elastic Endgame icon in the event.module column or the link in\nthe rule.reference column for...", "output": "event.kind:alert and event.module:endgame and (event.action:behavior_protection_event or endgame.event_subtype_full:behavior_protection_event)\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Elastic Endgame detected Malware. Click the Elastic Endgame icon in the event.module column or the link in the\nrule.reference column for additional in...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:file_classification_event or endgame.event_subtype_full:file_classification_event)\n", "source": "detection-rules/promotions", "severity": "critical", "risk_score": 99}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Elastic Endgame prevented Malware. Click the Elastic Endgame icon in the event.module column or the link in the\nrule.reference column for additional i...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:file_classification_event or endgame.event_subtype_full:file_classification_event)\n", "source": "detection-rules/promotions", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Elastic Endgame detected ransomware. Click the Elastic Endgame icon in the event.module column or the link in the\nrule.reference column for additional...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:ransomware_event or endgame.event_subtype_full:ransomware_event)\n", "source": "detection-rules/promotions", "severity": "critical", "risk_score": 99}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Elastic Endgame prevented ransomware. Click the Elastic Endgame icon in the event.module column or the link in the\nrule.reference column for additiona...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:ransomware_event or endgame.event_subtype_full:ransomware_event)\n", "source": "detection-rules/promotions", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Exploitation for Privilege Escalation", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:exploit_event or endgame.event_subtype_full:exploit_event)\n", "source": "detection-rules/promotions", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Elastic Endgame prevented an Exploit. Click the Elastic Endgame icon in the event.module column or the link in the\nrule.reference column for additiona...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:exploit_event or endgame.event_subtype_full:exploit_event)\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Generates a detection alert for each external alert written to the configured indices. Enabling this rule allows you to\nimmediately begin investigatin...", "output": "event.kind:alert and not event.module:(endgame or endpoint or cloud_defend)\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Generates a detection alert for each Google SecOps alert written to the configured indices. Enabling this rule allows\nyou to immediately begin investi...", "output": "event.kind: alert and data_stream.dataset: google_secops.alert\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Generates a detection alert for each Microsoft Sentinel alert written to the configured indices. Enabling this rule\nallows you to immediately begin in...", "output": "event.kind: alert and data_stream.dataset: microsoft_sentinel.alert\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Elastic Endgame detected Credential Manipulation. Click the Elastic Endgame icon in the event.module column or the link\nin the rule.reference column f...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:token_manipulation_event or endgame.event_subtype_full:token_manipulation_event)\n", "source": "detection-rules/promotions", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Access Token Manipulation", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:token_manipulation_event or endgame.event_subtype_full:token_manipulation_event)\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Access Token Manipulation", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:token_protection_event or endgame.event_subtype_full:token_protection_event)\n", "source": "detection-rules/promotions", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Elastic Endgame prevented Permission Theft. Click the Elastic Endgame icon in the event.module column or the link in the\nrule.reference column for add...", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:token_protection_event or endgame.event_subtype_full:token_protection_event)\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Process Injection", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:detection and (event.action:kernel_shellcode_event or endgame.event_subtype_full:kernel_shellcode_event)\n", "source": "detection-rules/promotions", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Process Injection", "output": "event.kind:alert and event.module:endgame and endgame.metadata.type:prevention and (event.action:kernel_shellcode_event or endgame.event_subtype_full:kernel_shellcode_event)\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generates a detection alert for each SentinelOne alert written to the configured indices. Enabling this rule allows you\nto immediately begin investiga...", "output": "event.kind: event and data_stream.dataset: sentinel_one.alert\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Generates a detection alert for each SentinelOne threat written to the configured indices. Enabling this rule allows you\nto immediately begin investig...", "output": "event.kind: alert and data_stream.dataset: sentinel_one.threat\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Generates a detection alert for each Splunk alert written to the configured indices. Enabling this rule allows you to\nimmediately begin investigating ...", "output": "event.kind: alert and data_stream.dataset: splunk.alert\n", "source": "detection-rules/promotions", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule is triggered when an IP address indicator from the Threat Intel Filebeat module or integrations has a match\nagainst a network event.\n", "output": "source.ip:* or destination.ip:*\n", "source": "detection-rules/threat_intel", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "This rule is triggered when an email indicator from the Threat Intel Filebeat module or integrations matches an event\ncontaining email-related data, s...", "output": "email.from.address:* or email.sender.address:* or email.reply_to.address:* or email.to.address:*\n", "source": "detection-rules/threat_intel", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "This rule is triggered when a hash indicator from the Threat Intel Filebeat module or integrations has a match against\nan event that contains file has...", "output": "file.hash.*:* or process.hash.*:* or dll.hash.*:*\n", "source": "detection-rules/threat_intel", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "This rule is triggered when a Windows registry indicator from the Threat Intel Filebeat module or integrations has a\nmatch against an event that conta...", "output": "registry.path:*\n", "source": "detection-rules/threat_intel", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule is triggered when a URL indicator from the Threat Intel Filebeat module or integrations has a match against an\nevent that contains URL data,...", "output": "url.full:*\n", "source": "detection-rules/threat_intel", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: This rule is triggered when CVEs collected from the Rapid7 Threat Command Integration have a match against\nvulnerabilities that were found in the cust...", "output": "vulnerability.id : *\n", "source": "detection-rules/threat_intel", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Data from Local System", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : \"New-MailboxExportRequest\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Audio Capture", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"Get-MicrophoneAudio\" or\n    \"WindowsAudioDevice-Powershell-Cmdlet\" or\n    (waveInGetNumDevs and mciSendStringA)\n  )\n  and not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\" and \"PowerSploitIndicators\"\n  )\n  and not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Clipboard Data", "output": "event.category:process and host.os.type:windows and\n  (powershell.file.script_block_text : (\n    \"Windows.Clipboard\" or\n    \"Windows.Forms.Clipboard\" or\n    \"Windows.Forms.TextBox\"\n   ) and\n   powershell.file.script_block_text : (\n    \"]::GetText\" or\n    \".Paste()\"\n  )) or powershell.file.script_block_text : \"Get-Clipboard\" and\n  not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\" and \"PowerSploitIndicators\"\n  ) and\n  not user.id : \"S-1-5-18\" and\n  not (\n    file.path : *WindowsPowerShell\\\\Modules\\\\*.ps1 and\n    file.name : (\"Convert-ExcelRangeToImage.ps1\" or \"Read-Clipboard.ps1\")\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detects the use of Win32 API Functions that can be used to capture user keystrokes in PowerShell scripts. Attackers use\nthis technique to capture user...", "output": "event.category:process and host.os.type:windows and\n  (\n   powershell.file.script_block_text : (GetAsyncKeyState or NtUserGetAsyncKeyState or GetKeyboardState or \"Get-Keystrokes\") or\n   powershell.file.script_block_text : (\n        (SetWindowsHookA or SetWindowsHookW or SetWindowsHookEx or SetWindowsHookExA or NtUserSetWindowsHookEx) and\n        (GetForegroundWindow or GetWindowTextA or GetWindowTextW or \"WM_KEYBOARD_LL\" or \"WH_MOUSE_LL\")\n   )\n   ) and not user.id : \"S-1-5-18\"\n  and not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\"\n  )\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detects PowerShell scripts that can be used to collect data from mailboxes. Adversaries may target user email to collect\nsensitive information.\n", "output": "event.category:process and host.os.type:windows and\n  (\n    (\n      powershell.file.script_block_text : (\n        \"Microsoft.Office.Interop.Outlook\" or\n        \"Interop.Outlook.olDefaultFolders\" or\n        \"olFolderInBox\" or\n        \"Outlook.Application\"\n      ) and powershell.file.script_block_text : (\"MAPI\" or \"GetDefaultFolder\" or \"GetNamespace\" or \"Session\" or \"GetSharedDefaultFolder\")\n    ) or\n    (\n      powershell.file.script_block_text : (\n        \"Microsoft.Exchange.WebServices.Data.Folder\" or\n        \"Microsoft.Exchange.WebServices.Data.FileAttachment\" or\n        \"Microsoft.Exchange.WebServices.Data.ExchangeService\"\n      ) and\n      powershell.file.script_block_text : (\"FindItems\" or \"Bind\" or \"WellKnownFolderName\" or \"FolderId\" or \"ItemView\" or \"PropertySet\" or \"SearchFilter\" or \"Attachments\")\n    )\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Detects PowerShell scripts that can take screenshots, which is a common feature in post-exploitation kits and remote\naccess tools (RATs).\n", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    CopyFromScreen and\n    (\"System.Drawing.Bitmap\" or \"Drawing.Bitmap\")\n  ) and not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects PowerShell scripts that can be used to record webcam video. Attackers can capture this information to extort or\nspy on victims.\n", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"NewFrameEventHandler\" or\n    \"VideoCaptureDevice\" or\n    \"DirectX.Capture.Filters\" or\n    \"VideoCompressors\" or\n    \"Start-WebcamRecorder\" or\n    (\n      (\"capCreateCaptureWindowA\" or\n       \"capCreateCaptureWindow\" or\n       \"capGetDriverDescription\") and\n      (\"avicap32.dll\" or \"avicap32\")\n    )\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Adversaries may install legitimate remote access tools (RAT) to compromised endpoints for further command-and-control\n(C2). Adversaries can rely on in...", "output": "host.os.type: \"windows\" and\n\n   event.category: \"process\" and event.type : \"start\" and\n\n    (\n        process.code_signature.subject_name : (\n            \"Action1 Corporation\" or\n            \"AeroAdmin LLC\" or\n            \"Ammyy LLC\" or\n            \"Atera Networks Ltd\" or\n            \"AWERAY PTE. LTD.\" or\n            \"BeamYourScreen GmbH\" or\n            \"Bomgar Corporation\" or\n            \"DUC FABULOUS CO.,LTD\" or\n            \"DOMOTZ INC.\" or\n            \"DWSNET OÃœ\" or\n            \"FleetDeck Inc\" or\n            \"GlavSoft LLC\" or\n            \"GlavSoft LLC.\" or\n            \"Hefei Pingbo Network Technology Co. Ltd\" or\n            \"IDrive, Inc.\" or\n            \"IMPERO SOLUTIONS LIMITED\" or\n            \"Instant Housecall\" or\n            \"ISL Online Ltd.\" or\n            \"LogMeIn, Inc.\" or\n            \"Monitoring Client\" or\n            \"MMSOFT Design Ltd.\" or\n            \"Nanosystems S.r.l.\" or\n            \"NetSupport Ltd\" or \n\t    \"NetSupport Ltd.\" or \n\t    \"NETSUPPORT LTD.\" or \n            \"NinjaRMM, LLC\" or\n            \"Parallels International GmbH\" or\n            \"philandro Software GmbH\" or\n            \"Pro Softnet Corporation\" or\n            \"RealVNC\" or\n            \"RealVNC Limited\" or\n            \"BreakingSecurity.net\" or\n            \"Remote Utilities LLC\" or\n            \"Rocket Software, Inc.\" or\n            \"SAFIB\" or\n            \"Servably, Inc.\" or\n            \"ShowMyPC INC\" or\n            \"Splashtop Inc.\" or\n            \"Superops Inc.\" or\n            \"TeamViewer\" or\n            \"TeamViewer GmbH\" or\n            \"TeamViewer Germany GmbH\" or\n            \"Techinline Limited\" or\n            \"uvnc bvba\" or\n            \"Yakhnovets Denis Aleksandrovich IP\" or\n            \"Zhou Huabing\"\n        ) or\n\n        process.name.caseless : (\n            AA_v*.exe or\n            \"AeroAdmin.exe\" or\n            \"AnyDesk.exe\" or\n            \"apc_Admin.exe\" or\n            \"apc_host.exe\" or\n            \"AteraAgent.exe\" or\n            aweray_remote*.exe or\n            \"AweSun.exe\" or\n            \"B4-Service.exe\" or\n            \"BASupSrvc.exe\" or\n            \"bomgar-scc.exe\" or\n            \"domotzagent.exe\" or\n            \"domotz-windows-x64-10.exe\" or\n            \"dwagsvc.exe\" or\n            \"DWRCC.exe\" or\n            \"ImperoClientSVC.exe\" or\n            \"ImperoServerSVC.exe\" or\n            \"ISLLight.exe\" or\n            \"ISLLightClient.exe\" or\n            fleetdeck_commander*.exe or\n            \"getscreen.exe\" or\n            \"LMIIgnition.exe\" or\n            \"LogMeIn.exe\" or\n            \"ManageEngine_Remote_Access_Plus.exe\" or\n            \"Mikogo-Service.exe\" or\n            \"NinjaRMMAgent.exe\" or\n            \"NinjaRMMAgenPatcher.exe\" or\n            \"ninjarmm-cli.exe\" or\n            \"r_server.exe\" or\n            \"radmin.exe\" or\n            \"radmin3.exe\" or\n            \"RCClient.exe\" or\n            \"RCService.exe\" or\n            \"RemoteDesktopManager.exe\" or\n            \"RemotePC.exe\" or\n            \"RemotePCDesktop.exe\" or\n            \"RemotePCService.exe\" or\n            \"rfusclient.exe\" or\n            \"ROMServer.exe\" or\n            \"ROMViewer.exe\" or\n            \"RPCSuite.exe\" or\n            \"rserver3.exe\" or\n            \"rustdesk.exe\" or\n            \"rutserv.exe\" or\n            \"rutview.exe\" or\n            \"saazapsc.exe\" or\n            ScreenConnect*.exe or\n            \"smpcview.exe\" or\n            \"spclink.exe\" or\n            \"Splashtop-streamer.exe\" or\n            \"SRService.exe\" or\n            \"strwinclt.exe\" or\n            \"Supremo.exe\" or\n            \"SupremoService.exe\" or\n            \"teamviewer.exe\" or\n            \"TiClientCore.exe\" or\n            \"TSClient.exe\" or\n            \"tvn.exe\" or\n            \"tvnserver.exe\" or\n            \"tvnviewer.exe\" or\n            UltraVNC*.exe or\n            UltraViewer*.exe or\n            \"vncserver.exe\" or\n            \"vncviewer.exe\" or\n            \"winvnc.exe\" or\n            \"winwvc.exe\" or\n            \"Zaservice.exe\" or\n            \"ZohoURS.exe\"\n        ) or\n        process.name : (\n            AA_v*.exe or\n            \"AeroAdmin.exe\" or\n            \"AnyDesk.exe\" or\n            \"apc_Admin.exe\" or\n            \"apc_host.exe\" or\n            \"AteraAgent.exe\" or\n            aweray_remote*.exe or\n            \"AweSun.exe\" or\n            \"B4-Service.exe\" or\n            \"BASupSrvc.exe\" or\n            \"bomgar-scc.exe\" or\n            \"domotzagent.exe\" or\n            \"domotz-windows-x64-10.exe\" or\n            \"dwagsvc.exe\" or\n            \"DWRCC.exe\" or\n            \"ImperoClientSVC.exe\" or\n            \"ImperoServerSVC.exe\" or\n            \"ISLLight.exe\" or\n            \"ISLLightClient.exe\" or\n            fleetdeck_commander*.exe or\n            \"getscreen.exe\" or\n            \"LMIIgnition.exe\" or\n            \"LogMeIn.exe\" or\n            \"ManageEngine_Remote_Access_Plus.exe\" or\n            \"Mikogo-Service.exe\" or\n            \"NinjaRMMAgent.exe\" or\n            \"NinjaRMMAgenPatcher.exe\" or\n            \"ninjarmm-cli.exe\" or\n            \"r_server.exe\" or\n            \"radmin.exe\" or\n            \"radmin3.exe\" or\n            \"RCClient.exe\" or\n            \"RCService.exe\" or\n            \"RemoteDesktopManager.exe\" or\n            \"RemotePC.exe\" or\n            \"RemotePCDesktop.exe\" or\n            \"RemotePCService.exe\" or\n            \"rfusclient.exe\" or\n            \"ROMServer.exe\" or\n            \"ROMViewer.exe\" or\n            \"RPCSuite.exe\" or\n            \"rserver3.exe\" or\n            \"rustdesk.exe\" or\n            \"rutserv.exe\" or\n            \"rutview.exe\" or\n            \"saazapsc.exe\" or\n            ScreenConnect*.exe or\n            \"smpcview.exe\" or\n            \"spclink.exe\" or\n            \"Splashtop-streamer.exe\" or\n            \"SRService.exe\" or\n            \"strwinclt.exe\" or\n            \"Supremo.exe\" or\n            \"SupremoService.exe\" or\n            \"teamviewer.exe\" or\n            \"TiClientCore.exe\" or\n            \"TSClient.exe\" or\n            \"tvn.exe\" or\n            \"tvnserver.exe\" or\n            \"tvnviewer.exe\" or\n            UltraVNC*.exe or\n            UltraViewer*.exe or\n            \"vncserver.exe\" or\n            \"vncviewer.exe\" or\n            \"winvnc.exe\" or\n            \"winwvc.exe\" or\n            \"Zaservice.exe\" or\n            \"ZohoURS.exe\"\n        )\n\t) and\n\n\tnot (process.pe.original_file_name : (\"G2M.exe\" or \"Updater.exe\" or \"powershell.exe\") and process.code_signature.subject_name : \"LogMeIn, Inc.\")\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule identifies when a User Account starts the Active Directory Replication Process for the first time. Attackers\ncan use the DCSync technique to...", "output": "event.code:\"4662\" and winlog.event_data.Properties:(\n                               *DS-Replication-Get-Changes* or *DS-Replication-Get-Changes-All* or\n                               *DS-Replication-Get-Changes-In-Filtered-Set* or *1131f6ad-9c07-11d1-f79f-00c04fc2dcd2* or\n                               *1131f6aa-9c07-11d1-f79f-00c04fc2dcd2* or *89e95b76-444d-4c62-991a-0facbeda640c*) and\n not winlog.event_data.SubjectUserName:(*$ or MSOL_*)\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule identifies when a User Account starts the Active Directory Replication Process. Attackers can use the DCSync\ntechnique to get credential inf...", "output": "host.os.type:\"windows\" and event.code:\"4662\" and\n  winlog.event_data.Properties:(\n    *DS-Replication-Get-Changes* or *DS-Replication-Get-Changes-All* or\n    *DS-Replication-Get-Changes-In-Filtered-Set* or *1131f6ad-9c07-11d1-f79f-00c04fc2dcd2* or\n    *1131f6aa-9c07-11d1-f79f-00c04fc2dcd2* or *89e95b76-444d-4c62-991a-0facbeda640c*\n  ) and winlog.event_data.AccessMask : \"0x100\" and\n  not winlog.event_data.SubjectUserName:(*$ or MSOL_*)\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies the modification of the nTSecurityDescriptor attribute in a domain object with rights related to DCSync to a\nuser/computer account. Attacke...", "output": "event.code:\"5136\" and\n  winlog.event_data.AttributeLDAPDisplayName:\"nTSecurityDescriptor\" and\n  winlog.event_data.AttributeValue : (\n    (\n      *1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-* and\n      *1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-* and\n      *89e95b76-444d-4c62-991a-0facbeda640c;;S-1-5-21-*\n    )\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies the creation of a DNS record containing a base64-encoded blob matching the pattern \"UWhRCA...BAAAA\". This\npattern corresponds to a marshale...", "output": "(event.code:4662 and winlog.event_data.AdditionalInfo: *UWhRC*BAAAA*MicrosoftDNS*) or\n(event.code:5137 and winlog.event_data.ObjectDN: *UWhRC*BAAAA*MicrosoftDNS*)\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to OS Credential Dumping", "output": "host.os.type:\"windows\" and event.code:\"4656\" and\n  (\n    winlog.event_data.AccessMask : (\"0x1fffff\" or \"0x1010\" or \"0x120089\" or \"0x1F3FFF\") or\n    winlog.event_data.AccessMaskDescription : (\"READ_CONTROL\" or \"Read from process memory\")\n  ) and\n  winlog.event_data.ObjectName : *\\\\Windows\\\\System32\\\\lsass.exe and\n  not winlog.event_data.ProcessName : (\n      \"C:\\Windows\\System32\\wbem\\WmiPrvSE.exe\" or\n      \"C:\\Windows\\SysWOW64\\wbem\\WmiPrvSE.exe\" or\n      \"C:\\Windows\\System32\\dllhost.exe\" or\n      \"C:\\Windows\\System32\\svchost.exe\" or\n      \"C:\\Windows\\System32\\msiexec.exe\" or\n      \"C:\\Windows\\explorer.exe\"\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Mimikatz is a credential dumper capable of obtaining plaintext Windows account logins and passwords, along with many\nother features that make it usefu...", "output": "event.category:process and host.os.type:windows and\npowershell.file.script_block_text:(\n  (DumpCreds and\n  DumpCerts) or\n  \"sekurlsa::logonpasswords\" or\n  (\"crypto::certificates\" and\n  \"CERT_SYSTEM_STORE_LOCAL_MACHINE\")\n)\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects PowerShell scripts that contain the default exported functions used on Invoke-NinjaCopy. Attackers can use\nInvoke-NinjaCopy to read SYSTEM fil...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"StealthReadFile\" or\n    \"StealthReadFileAddr\" or\n    \"StealthCloseFileDelegate\" or\n    \"StealthOpenFile\" or\n    \"StealthCloseFile\" or\n    \"StealthReadFile\" or\n    \"Invoke-NinjaCopy\"\n   )\n  and not user.id : \"S-1-5-18\"\n  and not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\" and \"PowerSploitIndicators\"\n  )\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to OS Credential Dumping", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"LsaCallAuthenticationPackage\" and\n    (\n      \"KerbRetrieveEncodedTicketMessage\" or\n      \"KerbQueryTicketCacheMessage\" or\n      \"KerbQueryTicketCacheExMessage\" or\n      \"KerbQueryTicketCacheEx2Message\" or\n      \"KerbRetrieveTicketMessage\" or\n      \"KerbDecryptDataMessage\"\n    )\n  )\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: This rule detects PowerShell scripts capable of dumping process memory using WindowsErrorReporting or Dbghelp.dll\nMiniDumpWriteDump. Attackers can use...", "output": "event.category:process and host.os.type:windows and powershell.file.script_block_text:(MiniDumpWriteDump or MiniDumpWithFullMemory or pmuDetirWpmuDiniM) and not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects PowerShell scripts that can execute pass-the-hash (PtH) attacks, intercept and relay NTLM challenges, and carry\nout other man-in-the-middle (M...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    (\"NTLMSSPNegotiate\" and (\"NegotiateSMB\" or \"NegotiateSMB2\")) or\n    \"4E544C4D53535000\" or\n    \"0x4e,0x54,0x4c,0x4d,0x53,0x53,0x50\" or\n    \"0x4e,0x54,0x20,0x4c,0x4d\" or\n    \"0x53,0x4d,0x42,0x20,0x32\" or\n    \"0x81,0xbb,0x7a,0x36,0x44,0x98,0xf1,0x35,0xad,0x32,0x98,0xf0,0x38\"\n  ) and\n  not file.directory : \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\Downloads\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detects PowerShell scripts that have the capability of requesting kerberos tickets, which is a common step in\nKerberoasting toolkits to crack service ...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    KerberosRequestorSecurityToken\n  ) and not user.id : (\"S-1-5-18\" or \"S-1-5-20\") and\n  not powershell.file.script_block_text : (\n    (\"sentinelbreakpoints\" and (\"Set-PSBreakpoint\" or \"Set-HookFunctionTabs\")) or\n    (\"function global\" and \"\\\\windows\\\\sentinel\\\\4\")\n  )\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Steal or Forge Kerberos Tickets", "output": "event.code:4704 and winlog.event_data.PrivilegeList:\"SeEnableDelegationPrivilege\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Modify Authentication Process", "output": "event.code:\"5136\" and winlog.event_data.AttributeLDAPDisplayName:\"msDS-KeyCredentialLink\" and\n  winlog.event_data.AttributeValue :B\\:828* and\n  not winlog.event_data.SubjectUserName: MSOL_*\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Steal or Forge Kerberos Tickets", "output": "event.code:5136 and winlog.event_data.OperationType:\"%%14674\" and\n  winlog.event_data.ObjectClass:\"user\" and\n  winlog.event_data.AttributeLDAPDisplayName:\"servicePrincipalName\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies suspicious access to an LSASS handle via PssCaptureSnapShot where two successive process accesses are\nperformed by the same process and tar...", "output": "event.category:process and host.os.type:windows and event.code:10 and\n winlog.event_data.TargetImage:(\"C:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\System32\\\\lsass.exe\")\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects unusual access to the web.config file, which contains sensitive credential information such as database\nconnection strings, machineKey validat...", "output": "event.category:file and host.os.type:windows and event.action:open and\n  file.name:\"web.config\" and file.path : *VirtualDirectories*\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies attempts to disable auditing for some security sensitive audit policy sub-categories. This is often done by\nattackers in an attempt to evad...", "output": "event.code : \"4719\" and host.os.type : \"windows\" and\n  winlog.event_data.AuditPolicyChangesDescription : \"Success removed\" and\n  winlog.event_data.SubCategory : (\n     \"Logon\" or\n     \"Audit Policy Change\" or\n     \"Process Creation\" or\n     \"Audit Other System Events\" or\n     \"Audit Security Group Management\" or\n     \"Audit User Account Management\"\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Indicator Removal", "output": "host.os.type:windows and event.action:(\"audit-log-cleared\" or \"Log clear\") and\n  not winlog.provider_name:\"AD FS Auditing\"\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Subvert Trust Controls", "output": "event.provider:\"Microsoft-Windows-Audit-CVE\" and message:\"[CVE-2020-0601]\" and host.os.type:windows\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: An instance of MSBuild, the Microsoft Build Engine, was started by a script or the Windows command interpreter. This\nbehavior is unusual and is someti...", "output": "host.os.type:windows and event.category:process and event.type:start and (\n  process.name.caseless:\"msbuild.exe\" or process.pe.original_file_name:\"MSBuild.exe\") and\n  process.parent.name:(\"cmd.exe\" or \"powershell.exe\" or \"pwsh.exe\" or \"powershell_ise.exe\" or \"cscript.exe\" or\n    \"wscript.exe\" or \"mshta.exe\")\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: An instance of MSBuild, the Microsoft Build Engine, started a PowerShell script or the Visual C# Command Line Compiler.\nThis technique is sometimes us...", "output": "host.os.type:windows and event.category:process and event.type:start and process.parent.name:(\"MSBuild.exe\" or \"msbuild.exe\") and\nprocess.name:(\"csc.exe\" or \"iexplore.exe\" or \"powershell.exe\")\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Detects the use of Reflection.Assembly to load PEs and DLLs in memory in PowerShell scripts. Attackers use this method\nto load executables and DLLs wi...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"[System.Reflection.Assembly]::Load\" or\n    \"[Reflection.Assembly]::Load\" or\n    \"Assembly.Load(\"\n  ) and\n  not powershell.file.script_block_text : (\n        (\"CommonWorkflowParameters\" or \"RelatedLinksHelpInfo\") and\n        \"HelpDisplayStrings\"\n  ) and\n  not (powershell.file.script_block_text :\n        (\"Get-SolutionFiles\" or \"Get-VisualStudio\" or \"Select-MSBuildPath\") and\n        file.name : \"PathFunctions.ps1\"\n  ) and\n  not powershell.file.script_block_text : (\n        \"Microsoft.PowerShell.Workflow.ServiceCore\" and \"ExtractPluginProperties([string]$pluginDir\"\n  ) and \n  \n  not powershell.file.script_block_text : (\"reflection.assembly]::Load('System.\" or \"LoadWithPartialName('Microsoft.\" or \"::Load(\\\"Microsoft.\" or \"Microsoft.Build.Utilities.Core.dll\") and \n  \n  not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Identifies the use of .NET functionality for decompression and base64 decoding combined in PowerShell scripts, which\nmalware and security tools heavil...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    (\n      \"System.IO.Compression.DeflateStream\" or\n      \"System.IO.Compression.GzipStream\" or\n      \"IO.Compression.DeflateStream\" or\n      \"IO.Compression.GzipStream\"\n    ) and\n    FromBase64String\n  ) and\n  not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies PowerShell scripts containing cmdlets and parameters that attackers can abuse to disable Windows Defender\nfeatures. Attackers can tamper wi...", "output": "event.category: \"process\" and host.os.type:windows and\n(\n  powershell.file.script_block_text: \"Set-MpPreference\" and\n  powershell.file.script_block_text: (\n    DisableArchiveScanning or DisableBehaviorMonitoring or\n    DisableIntrusionPreventionSystem or DisableIOAVProtection or\n    DisableRemovableDriveScanning or DisableBlockAtFirstSeen or\n    DisableScanningMappedNetworkDrivesForFullScan or\n    DisableScanningNetworkFiles or DisableScriptScanning or\n    DisableRealtimeMonitoring or LowThreatDefaultAction or\n    ModerateThreatDefaultAction or HighThreatDefaultAction\n  )\n) and\nnot powershell.file.script_block_text : (\n  (\"cmdletization\" and \"cdxml-Help.xml\") or\n  (\"function Set-MpPreference\" and \"Microsoft.PowerShell.Cmdletization.GeneratedTypes.MpPreference.SubmitSamplesConsentType\")\n) and\nnot file.directory : \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\SenseCM\" and\nnot user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies the use of Cmdlets and methods related to encryption/decryption of files in PowerShell scripts, which malware\nand offensive security tools ...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    (\n      \"Cryptography.AESManaged\" or\n      \"Cryptography.RijndaelManaged\" or\n      \"Cryptography.SHA1Managed\" or\n      \"Cryptography.SHA256Managed\" or\n      \"Cryptography.SHA384Managed\" or\n      \"Cryptography.SHA512Managed\" or\n      \"Cryptography.SymmetricAlgorithm\" or\n      \"PasswordDeriveBytes\" or\n      \"Rfc2898DeriveBytes\"\n    ) and\n    (\n      CipherMode and PaddingMode\n    ) and\n    (\n      \".CreateEncryptor\" or\n      \".CreateDecryptor\"\n    )\n  ) and\n  not user.id : \"S-1-5-18\" and\n  not (\n    file.name : \"Bootstrap.Octopus.FunctionAppenderContext.ps1\" and\n    powershell.file.script_block_text : (\"function Decrypt-Variables\" or \"github.com/OctopusDeploy\")\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies scripts that contain patterns and known methods that obfuscate PowerShell code. Attackers can use obfuscation\ntechniques to bypass PowerShe...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"[string]::join\" or\n    \"-Join\" or\n    \"[convert]::toint16\" or\n    \"[char][int]$_\" or\n    (\"ConvertTo-SecureString\" and \"PtrToStringAuto\") or\n    \".GetNetworkCredential().password\" or\n    \"-BXor\" or\n    (\"replace\" and \"char\") or\n    \"[array]::reverse\" or\n    \"-replace\"\n  ) and\n  powershell.file.script_block_text : (\n    (\"$pSHoMe[\" and \"+$pSHoMe[\") or\n    (\"$ShellId[\" and \"+$ShellId[\") or\n    (\"$env:ComSpec[4\" and \"25]-Join\") or\n    ((\"Set-Variable\" or \"SV\" or \"Set-Item\") and \"OFS\") or\n    (\"*MDR*\" and \"Name[3,11,2]\") or\n    (\"$VerbosePreference\" and \"[1,3]+'X'-Join''\") or\n    (\"rahc\" or \"ekovin\" or \"gnirts\" or \"ecnereferpesobrev\" or \"ecalper\" or \"cepsmoc\" or \"dillehs\") or\n    (\"System.Management.Automation.$([cHAr]\" or \"System.$([cHAr]\" or \")+[cHAR]([byte]\")\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detects the use of Windows API functions that are commonly abused by malware and security tools to load malicious code\nor inject it into remote proces...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n   (VirtualAlloc or VirtualAllocEx or VirtualProtect or LdrLoadDll or LoadLibrary or LoadLibraryA or\n      LoadLibraryEx or GetProcAddress or OpenProcess or OpenProcessToken or AdjustTokenPrivileges) and\n   (WriteProcessMemory or CreateRemoteThread or NtCreateThreadEx or CreateThread or QueueUserAPC or\n      SuspendThread or ResumeThread or GetDelegateForFunctionPointer)\n  ) and not \n  file.directory: (\n    \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\SenseCM\" or\n    \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\Downloads\"\n  )\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Network Share Discovery", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text:(\n    \"Invoke-ShareFinder\" or\n    \"Invoke-ShareFinderThreaded\" or\n    (\n      \"shi1_netname\" and\n      \"shi1_remark\"\n    ) or\n    (\n      \"NetShareEnum\" and\n      \"NetApiBufferFree\"\n    )\n  ) and not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule detects the use of discovery-related Windows API functions in PowerShell Scripts. Attackers can use these\nfunctions to perform various situa...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    NetShareEnum or\n    NetWkstaUserEnum or\n    NetSessionEnum or\n    NetLocalGroupEnum or\n    NetLocalGroupGetMembers or\n    DsGetSiteName or\n    DsEnumerateDomainTrusts or\n    WTSEnumerateSessionsEx or\n    WTSQuerySessionInformation or\n    LsaGetLogonSessionData or\n    QueryServiceObjectSecurity or\n    GetComputerNameEx or\n    NetWkstaGetInfo or\n    GetUserNameEx or\n    NetUserEnum or\n    NetUserGetInfo or\n    NetGroupEnum or\n    NetGroupGetInfo or\n    NetGroupGetUsers or\n    NetWkstaTransportEnum or\n    NetServerGetInfo or\n    LsaEnumerateTrustedDomains  or\n    NetScheduleJobEnum or\n    NetUserModalsGet\n  ) and\n  not powershell.file.script_block_text : (\n    (\"DsGetSiteName\" and (\"DiscoverWindowsComputerProperties.ps1\" and \"param($SourceType, $SourceId, $ManagedEntityId, $ComputerIdentity)\")) or\n    (\"# Copyright: (c) 2018, Ansible Project\" and \"#Requires -Module Ansible.ModuleUtils.AddType\" and \"#AnsibleRequires -CSharpUtil Ansible.Basic\") or\n    (\"Ansible.Windows.Setup\" and \"Ansible.Windows.Setup\" and \"NativeMethods.NetWkstaGetInfo(null, 100, out netBuffer);\")\n  )\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies instances of an unusual process enumerating built-in Windows privileged local groups membership like\nAdministrators or Remote Desktop users...", "output": "host.os.type:windows and event.category:iam and event.action:user-member-enumerated and\n  (\n    group.name:(*Admin* or \"RemoteDesktopUsers\") or\n    winlog.event_data.TargetSid:(\"S-1-5-32-544\" or \"S-1-5-32-555\")\n  ) and \n  not (\n    winlog.event_data.SubjectUserName: *$ or\n    winlog.event_data.SubjectUserSid: (\"S-1-5-19\" or \"S-1-5-20\") or \n    winlog.event_data.CallerProcessName:(\"-\" or \n                                       C\\:\\\\Windows\\\\System32\\\\VSSVC.exe or \n                                       C\\:\\\\Windows\\\\System32\\\\SearchIndexer.exe or \n                                       C\\:\\\\Windows\\\\System32\\\\CompatTelRunner.exe or \n                                       C\\:\\\\Windows\\\\System32\\\\oobe\\\\msoobe.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\net1.exe or \n                                       C\\:\\\\Windows\\\\System32\\\\svchost.exe or \n                                       C\\:\\\\Windows\\\\System32\\\\Netplwiz.exe or \n                                       C\\:\\\\Windows\\\\System32\\\\msiexec.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\CloudExperienceHostBroker.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\RuntimeBroker.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\wbem\\\\WmiPrvSE.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\SrTasks.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\diskshadow.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\dfsrs.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\vssadmin.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\dllhost.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\mmc.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\SettingSyncHost.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\inetsrv\\\\w3wp.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\wsmprovhost.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\mstsc.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\esentutl.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\RecoveryDrive.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\SystemPropertiesComputerName.exe or\n                                       C\\:\\\\Windows\\\\SysWOW64\\\\msiexec.exe or\n                                       C\\:\\\\Windows\\\\System32\\\\taskhostw.exe or\n                                       C\\:\\\\Windows\\\\ImmersiveControlPanel\\\\SystemSettings.exe or\n                                       C\\:\\\\Windows\\\\Temp\\\\rubrik_vmware*\\\\snaptool.exe or\n                                       C\\:\\\\Windows\\\\VeeamVssSupport\\\\VeeamGuestHelper.exe or\n                                       C\\:\\\\WindowsAzure\\\\*WaAppAgent.exe or\n                                       C\\:\\\\$WINDOWS.~BT\\\\Sources\\\\*.exe\n                                      )\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule leverages alert data from various Discovery building block rules to alert on signals with unusual unique\nhost.id, user.id and process.comman...", "output": "host.os.type:windows and event.kind:signal and kibana.alert.rule.rule_id:(\n  \"d68e95ad-1c82-4074-a12a-125fe10ac8ba\" or \"7b8bfc26-81d2-435e-965c-d722ee397ef1\" or\n  \"0635c542-1b96-4335-9b47-126582d2c19a\" or \"6ea55c81-e2ba-42f2-a134-bccf857ba922\" or\n  \"e0881d20-54ac-457f-8733-fe0bc5d44c55\" or \"06568a02-af29-4f20-929c-f3af281e41aa\" or\n  \"c4e9ed3e-55a2-4309-a012-bc3c78dad10a\" or \"51176ed2-2d90-49f2-9f3d-17196428b169\"\n)\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "This rule leverages Discovery building block rule alert data to alert on signals with unusual unique host.id, user.id\nand process.executable entries.\n", "output": "host.os.type:windows and event.kind:signal and kibana.alert.rule.rule_id:\"1d72d014-e2ab-4707-b056-9b96abe7b511\"\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Identifies a suspicious parent child process relationship with cmd.exe descending from svchost.exe", "output": "host.os.type:windows and event.category:process and event.type:start and process.parent.name:\"svchost.exe\" and\nprocess.name:(\"cmd.exe\" or \"Cmd.exe\" or \"CMD.EXE\") and\n\n  not process.command_line : \"\\\"cmd.exe\\\" /C sc control hptpsmarthealthservice 211\"\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects known PowerShell offensive tooling author's name in PowerShell scripts. Attackers commonly use out-of-the-box\noffensive tools without modifyin...", "output": "host.os.type:windows and event.category:process and\n  powershell.file.script_block_text : (\n      \"mattifestation\" or \"JosephBialek\" or\n      \"harmj0y\" or \"ukstufus\" or\n      \"SecureThisShit\" or \"Matthew Graeber\" or\n      \"secabstraction\" or \"mgeeky\" or\n      \"oddvarmoe\" or \"am0nsec\" or\n      \"obscuresec\" or \"sixdub\" or\n      \"darkoperator\" or \"funoverip\" or\n      \"rvrsh3ll\" or \"kevin_robertson\" or\n      \"dafthack\" or \"r4wd3r\" or\n      \"danielhbohannon\" or \"OneLogicalMyth\" or\n      \"cobbr_io\" or \"xorrior\" or\n      \"PetrMedonos\" or \"citronneur\" or\n      \"eladshamir\" or \"RastaMouse\" or\n      \"enigma0x3\" or \"FuzzySec\" or\n      \"424f424f\" or \"jaredhaight\" or\n      \"fullmetalcache\" or \"Hubbl3\" or\n      \"curi0usJack\" or \"Cx01N\" or\n      \"itm4n\" or \"nurfed1\" or\n      \"cfalta\" or \"Scott Sutherland\" or\n      \"_nullbind\" or \"_tmenochet\" or\n      \"jaredcatkinson\" or \"ChrisTruncer\" or\n      \"monoxgas\" or \"TheRealWover\" or\n      \"splinter_code\"\n  ) and\n  not powershell.file.script_block_text : (\"Get-UEFIDatabaseSigner\" or \"Posh-SSH\")\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Detects known PowerShell offensive tooling functions names in PowerShell scripts. Attackers commonly use out-of-the-box\noffensive tools without modify...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"Add-DomainGroupMember\" or \"Add-DomainObjectAcl\" or\n    \"Add-RemoteConnection\" or \"Add-ServiceDacl\" or\n    \"Add-Win32Type\" or \"Convert-ADName\" or\n    \"Convert-LDAPProperty\" or \"ConvertFrom-LDAPLogonHours\" or\n    \"ConvertFrom-UACValue\" or \"Copy-ArrayOfMemAddresses\" or\n    \"Create-NamedPipe\" or \"Create-ProcessWithToken\" or\n    \"Create-RemoteThread\" or \"Create-SuspendedWinLogon\" or\n    \"Create-WinLogonProcess\" or \"Emit-CallThreadStub\" or\n    \"Enable-SeAssignPrimaryTokenPrivilege\" or \"Enable-SeDebugPrivilege\" or\n    \"Enum-AllTokens\" or \"Export-PowerViewCSV\" or\n    \"Find-AVSignature\" or \"Find-AppLockerLog\" or\n    \"Find-DomainLocalGroupMember\" or \"Find-DomainObjectPropertyOutlier\" or\n    \"Find-DomainProcess\" or \"Find-DomainShare\" or\n    \"Find-DomainUserEvent\" or \"Find-DomainUserLocation\" or\n    \"Find-InterestingDomainAcl\" or \"Find-InterestingDomainShareFile\" or\n    \"Find-InterestingFile\" or \"Find-LocalAdminAccess\" or\n    \"Find-PSScriptsInPSAppLog\" or \"Find-PathDLLHijack\" or\n    \"Find-ProcessDLLHijack\" or \"Find-RDPClientConnection\" or\n    \"Get-AllAttributesForClass\" or \"Get-CachedGPPPassword\" or\n    \"Get-DecryptedCpassword\" or \"Get-DecryptedSitelistPassword\" or\n    \"Get-DelegateType\" or \"New-RelayEnumObject\" or\n    \"Get-DomainDFSShare\" or \"Get-DomainDFSShareV1\" or\n    \"Get-DomainDFSShareV2\" or \"Get-DomainDNSRecord\" or\n    \"Get-DomainDNSZone\" or \"Get-DomainFileServer\" or\n    \"Get-DomainForeignGroupMember\" or \"Get-DomainForeignUser\" or\n    \"Get-DomainGPO\" or \"Get-DomainGPOComputerLocalGroupMapping\" or\n    \"Get-DomainGPOLocalGroup\" or \"Get-DomainGPOUserLocalGroupMapping\" or\n    \"Get-DomainGUIDMap\" or \"Get-DomainGroup\" or\n    \"Get-DomainGroupMember\" or \"Get-DomainGroupMemberDeleted\" or\n    \"Get-DomainManagedSecurityGroup\" or \"Get-DomainOU\" or\n    \"Get-DomainObject\" or \"Get-DomainObjectAcl\" or\n    \"Get-DomainObjectAttributeHistory\" or \"Get-DomainObjectLinkedAttributeHistory\" or\n    \"Get-DomainPolicyData\" or \"Get-DomainSID\" or\n    \"Get-DomainSPNTicket\" or \"Get-DomainSearcher\" or\n    \"Get-DomainSite\" or \"Get-DomainSubnet\" or\n    \"Get-DomainTrust\" or \"Get-DomainTrustMapping\" or\n    \"Get-DomainUser\" or \"Get-DomainUserEvent\" or\n    \"Get-Forest\" or \"Get-ForestDomain\" or\n    \"Get-ForestGlobalCatalog\" or \"Get-ForestSchemaClass\" or\n    \"Get-ForestTrust\" or \"Get-GPODelegation\" or\n    \"Get-GPPAutologon\" or \"Get-GPPInnerField\" or\n    \"Get-GPPInnerFields\" or \"Get-GPPPassword\" or\n    \"Get-GptTmpl\" or \"Get-GroupsXML\" or\n    \"Get-HttpStatus\" or \"Get-ImageNtHeaders\" or\n    \"Get-Keystrokes\" or \"New-SOASerialNumberArray\" or\n    \"Get-MemoryProcAddress\" or \"Get-MicrophoneAudio\" or\n    \"Get-ModifiablePath\" or \"Get-ModifiableRegistryAutoRun\" or\n    \"Get-ModifiableScheduledTaskFile\" or \"Get-ModifiableService\" or\n    \"Get-ModifiableServiceFile\" or \"Get-Name\" or\n    \"Get-NetComputerSiteName\" or \"Get-NetLocalGroup\" or\n    \"Get-NetLocalGroupMember\" or \"Get-NetLoggedon\" or\n    \"Get-NetRDPSession\" or \"Get-NetSession\" or\n    \"Get-NetShare\" or \"Get-PEArchitecture\" or\n    \"Get-PEBasicInfo\" or \"Get-PEDetailedInfo\" or\n    \"Get-PathAcl\" or \"Get-PrimaryToken\" or\n    \"Get-ProcAddress\" or \"Get-ProcessTokenGroup\" or\n    \"Get-ProcessTokenPrivilege\" or \"Get-ProcessTokenType\" or\n    \"Get-RegLoggedOn\" or \"Get-RegistryAlwaysInstallElevated\" or\n    \"Get-RegistryAutoLogon\" or \"Get-RemoteProcAddress\" or\n    \"Get-Screenshot\" or \"Get-ServiceDetail\" or\n    \"Get-SiteListPassword\" or \"Get-SitelistField\" or\n    \"Get-System\" or \"Get-SystemNamedPipe\" or\n    \"Get-SystemToken\" or \"Get-ThreadToken\" or\n    \"Get-TimedScreenshot\" or \"Get-TokenInformation\" or\n    \"Get-TopPort\" or \"Get-UnattendedInstallFile\" or\n    \"Get-UniqueTokens\" or \"Get-UnquotedService\" or\n    \"Get-VaultCredential\" or \"Get-VaultElementValue\" or\n    \"Get-VirtualProtectValue\" or \"Get-VolumeShadowCopy\" or\n    \"Get-WMIProcess\" or \"Get-WMIRegCachedRDPConnection\" or\n    \"Get-WMIRegLastLoggedOn\" or \"Get-WMIRegMountedDrive\" or\n    \"Get-WMIRegProxy\" or \"Get-WebConfig\" or\n    \"Get-Win32Constants\" or \"Get-Win32Functions\" or\n    \"Get-Win32Types\" or \"Import-DllImports\" or\n    \"Import-DllInRemoteProcess\" or \"Inject-LocalShellcode\" or\n    \"Inject-RemoteShellcode\" or \"Install-ServiceBinary\" or\n    \"Invoke-CompareAttributesForClass\" or \"Invoke-CreateRemoteThread\" or\n    \"Invoke-CredentialInjection\" or \"Invoke-DllInjection\" or\n    \"Invoke-EventVwrBypass\" or \"Invoke-ImpersonateUser\" or\n    \"Invoke-Kerberoast\" or \"Invoke-MemoryFreeLibrary\" or\n    \"Invoke-MemoryLoadLibrary\" or\n    \"Invoke-Mimikatz\" or \"Invoke-NinjaCopy\" or\n    \"Invoke-PatchDll\" or \"Invoke-Portscan\" or\n    \"Invoke-PrivescAudit\" or \"Invoke-ReflectivePEInjection\" or\n    \"Invoke-ReverseDnsLookup\" or \"Invoke-RevertToSelf\" or\n    \"Invoke-ServiceAbuse\" or \"Invoke-Shellcode\" or\n    \"Invoke-TokenManipulation\" or \"Invoke-UserImpersonation\" or\n    \"Invoke-WmiCommand\" or \"Mount-VolumeShadowCopy\" or\n    \"New-ADObjectAccessControlEntry\" or \"New-DomainGroup\" or\n    \"New-DomainUser\" or \"New-DynamicParameter\" or\n    \"New-InMemoryModule\" or\n    \"New-ThreadedFunction\" or \"New-VolumeShadowCopy\" or\n    \"Out-CompressedDll\" or \"Out-EncodedCommand\" or\n    \"Out-EncryptedScript\" or \"Out-Minidump\" or\n    \"PortScan-Alive\" or \"Portscan-Port\" or\n    \"Remove-DomainGroupMember\" or \"Remove-DomainObjectAcl\" or\n    \"Remove-RemoteConnection\" or \"Remove-VolumeShadowCopy\" or\n    \"Restore-ServiceBinary\" or \"Set-DesktopACLToAllowEveryone\" or\n    \"Set-DesktopACLs\" or \"Set-DomainObject\" or\n    \"Set-DomainObjectOwner\" or \"Set-DomainUserPassword\" or\n    \"Set-ServiceBinaryPath\" or \"Sub-SignedIntAsUnsigned\" or\n    \"Test-AdminAccess\" or \"Test-MemoryRangeValid\" or\n    \"Test-ServiceDaclPermission\" or \"Update-ExeFunctions\" or\n    \"Update-MemoryAddresses\" or \"Update-MemoryProtectionFlags\" or\n    \"Write-BytesToMemory\" or \"Write-HijackDll\" or\n    \"Write-PortscanOut\" or \"Write-ServiceBinary\" or\n    \"Write-UserAddMSI\" or \"Invoke-Privesc\" or\n    \"func_get_proc_address\" or \"Invoke-BloodHound\" or\n    \"Invoke-HostEnum\" or \"Get-BrowserInformation\" or\n    \"Get-DomainAccountPolicy\" or \"Get-DomainAdmins\" or\n    \"Get-AVProcesses\" or \"Get-AVInfo\" or\n    \"Get-RecycleBin\" or \"Invoke-BruteForce\" or\n    \"Get-PassHints\" or \"Invoke-SessionGopher\" or\n    \"Get-LSASecret\" or \"Get-PassHashes\" or\n    \"Invoke-WdigestDowngrade\" or \"Get-ChromeDump\" or\n    \"Invoke-DomainPasswordSpray\" or \"Get-FoxDump\" or\n    \"New-HoneyHash\" or \"Invoke-DCSync\" or\n    \"Invoke-PowerDump\" or \"Invoke-SSIDExfil\" or\n    \"Invoke-PowerShellTCP\" or \"Add-Exfiltration\" or\n    \"Do-Exfiltration\" or \"Invoke-DropboxUpload\" or\n    \"Invoke-ExfilDataToGitHub\" or \"Invoke-EgressCheck\" or\n    \"Invoke-PostExfil\" or \"Create-MultipleSessions\" or\n    \"Invoke-NetworkRelay\" or \"New-GPOImmediateTask\" or\n    \"Invoke-WMIDebugger\" or \"Invoke-SQLOSCMD\" or\n    \"Invoke-SMBExec\" or \"Invoke-PSRemoting\" or\n    \"Invoke-ExecuteMSBuild\" or \"Invoke-DCOM\" or\n    \"Invoke-InveighRelay\" or \"Invoke-PsExec\" or\n    \"Find-ActiveUsersWMI\" or\n    \"Get-SystemDrivesWMI\" or \"Get-ActiveNICSWMI\" or\n    \"Remove-Persistence\" or \"DNS_TXT_Pwnage\" or\n    \"Execute-OnTime\" or \"HTTP-Backdoor\" or\n    \"Add-ConstrainedDelegationBackdoor\" or \"Add-RegBackdoor\" or\n    \"Add-ScrnSaveBackdoor\" or \"Gupt-Backdoor\" or\n    \"Invoke-ADSBackdoor\" or \"Add-Persistence\" or\n    \"Invoke-ResolverBackdoor\" or \"Invoke-EventLogBackdoor\" or\n    \"Invoke-DeadUserBackdoor\" or \"Invoke-DisableMachineAcctChange\" or\n    \"Invoke-AccessBinary\" or \"Add-NetUser\" or\n    \"Invoke-Schtasks\" or \"Invoke-JSRatRegsvr\" or\n    \"Invoke-JSRatRundll\" or \"Invoke-PoshRatHttps\" or\n    \"Invoke-PsGcatAgent\" or \"Remove-PoshRat\" or\n    \"Install-SSP\" or \"Invoke-BackdoorLNK\" or\n    \"PowerBreach\" or \"InstallEXE-Persistence\" or\n    \"RemoveEXE-Persistence\" or \"Install-ServiceLevel-Persistence\" or\n    \"Remove-ServiceLevel-Persistence\" or \"Invoke-Prompt\" or\n    \"Invoke-PacketCapture\" or \"Start-WebcamRecorder\" or\n    \"Get-USBKeyStrokes\" or \"Invoke-KeeThief\" or\n    \"Get-Keystrokes\" or \"Invoke-NetRipper\" or\n    \"Get-EmailItems\" or \"Invoke-MailSearch\" or\n    \"Invoke-SearchGAL\" or \"Get-WebCredentials\" or\n    \"Start-CaptureServer\" or \"Invoke-PowerShellIcmp\" or\n    \"Invoke-PowerShellTcpOneLine\" or \"Invoke-PowerShellTcpOneLineBind\" or\n    \"Invoke-PowerShellUdp\" or \"Invoke-PowerShellUdpOneLine\" or\n    \"Run-EXEonRemote\" or \"Download-Execute-PS\" or\n    \"Out-RundllCommand\" or \"Set-RemoteWMI\" or\n    \"Set-DCShadowPermissions\" or \"Invoke-PowerShellWMI\" or\n    \"Invoke-Vnc\" or \"Invoke-LockWorkStation\" or\n    \"Invoke-EternalBlue\" or \"Invoke-ShellcodeMSIL\" or\n    \"Invoke-MetasploitPayload\" or \"Invoke-DowngradeAccount\" or\n    \"Invoke-RunAs\" or \"ExetoText\" or\n    \"Disable-SecuritySettings\" or \"Set-MacAttribute\" or\n    \"Invoke-MS16032\" or \"Invoke-BypassUACTokenManipulation\" or\n    \"Invoke-SDCLTBypass\" or \"Invoke-FodHelperBypass\" or\n    \"Invoke-EventVwrBypass\" or \"Invoke-EnvBypass\" or\n    \"Get-ServiceUnquoted\" or \"Get-ServiceFilePermission\" or\n    \"Get-ServicePermission\" or\n    \"Enable-DuplicateToken\" or \"Invoke-PsUaCme\" or\n    \"Invoke-Tater\" or \"Invoke-WScriptBypassUAC\" or\n    \"Invoke-AllChecks\" or \"Find-TrustedDocuments\" or\n    \"Invoke-Interceptor\" or \"Invoke-PoshRatHttp\" or\n    \"Invoke-ExecCommandWMI\" or \"Invoke-KillProcessWMI\" or\n    \"Invoke-CreateShareandExecute\" or \"Invoke-RemoteScriptWithOutput\" or\n    \"Invoke-SchedJobManipulation\" or \"Invoke-ServiceManipulation\" or\n    \"Invoke-PowerOptionsWMI\" or \"Invoke-DirectoryListing\" or\n    \"Invoke-FileTransferOverWMI\" or \"Invoke-WMImplant\" or\n    \"Invoke-WMIObfuscatedPSCommand\" or \"Invoke-WMIDuplicateClass\" or\n    \"Invoke-WMIUpload\" or \"Invoke-WMIRemoteExtract\" or \"Invoke-winPEAS\" or\n    \"Invoke-AzureHound\" or \"Invoke-SharpHound\"\n  ) and\n  not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\"\n  ) and\n  not user.id : (\"S-1-5-18\" or \"S-1-5-19\")\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Command and Scripting Interpreter", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    TVqQAAMAAAAEAAAA\n  ) and not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Detects the use of PSReflect in PowerShell scripts. Attackers leverage PSReflect as a library that enables PowerShell to\naccess win32 API functions.\n", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text:(\n    \"New-InMemoryModule\" or\n    \"Add-Win32Type\" or\n    psenum or\n    DefineDynamicAssembly or\n    DefineDynamicModule or\n    \"Reflection.TypeAttributes\" or\n    \"Reflection.Emit.OpCodes\" or\n    \"Reflection.Emit.CustomAttributeBuilder\" or\n    \"Runtime.InteropServices.DllImportAttribute\"\n  ) and\n  not user.id : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Command and Scripting Interpreter", "output": "host.os.type:windows and event.category:library and\n  dll.name:(\"System.Management.Automation.dll\" or \"System.Management.Automation.ni.dll\") and\n  not (\n    process.code_signature.subject_name:(\n      \"Microsoft Corporation\" or\n      \"Microsoft Dynamic Code Publisher\" or\n      \"Microsoft Windows\"\n    ) and process.code_signature.trusted:true and not process.name.caseless:\"regsvr32.exe\"\n  ) and\n  not (\n    process.executable:(C\\:\\\\Program*Files*\\(x86\\)\\\\*.exe or C\\:\\\\Program*Files\\\\*.exe) and\n    process.code_signature.trusted:true\n  ) and\n  not (\n    process.executable: C\\:\\\\Windows\\\\Lenovo\\\\*.exe and process.code_signature.subject_name:\"Lenovo\" and\n    process.code_signature.trusted:true\n  ) and\n  not (\n    process.executable: C\\:\\\\Windows\\\\AdminArsenal\\\\PDQInventory-Scanner\\\\service-*\\\\exec\\\\PDQInventoryScanner.exe and\n    process.code_signature.subject_name:\"PDQ.com Corporation\" and\n    process.code_signature.trusted:true\n  ) and\n  not (\n    process.executable: C\\:\\\\Windows\\\\Temp\\\\\\{*\\}\\\\_is*.exe and\n    process.code_signature.subject_name:(\"Dell Technologies Inc.\" or \"Dell Inc\" or \"Dell Inc.\") and\n    process.code_signature.trusted:true\n  ) and\n  not (\n    process.executable: C\\:\\\\ProgramData\\\\chocolatey\\\\* and\n    process.code_signature.subject_name:(\"Chocolatey Software, Inc.\" or \"Chocolatey Software, Inc\") and\n    process.code_signature.trusted:true\n  ) and\n  not process.executable : (\n    \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\" or\n    \"C:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Exfiltration Over Alternative Protocol", "output": "event.category:network and host.os.type:windows and process.pid:4 and\n  network.transport:tcp and destination.port:(139 or 445) and\n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: This rule identifies a high number (10) of process terminations (stop, delete, or suspend) from the same host within a\nshort time period.\n", "output": "event.category:process and host.os.type:windows and event.type:start and process.name:(net.exe or sc.exe or taskkill.exe) and\n process.args:(stop or pause or delete or \"/PID\" or \"/IM\" or \"/T\" or \"/F\" or \"/t\" or \"/f\" or \"/im\" or \"/pid\") and\n not process.parent.name:(osquerybeat.exe or agentbeat.exe)\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Replication Through Removable Media", "output": "event.category:\"registry\" and host.os.type:\"windows\" and registry.value:\"FriendlyName\" and registry.path:*USBSTOR*\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Use Alternate Authentication Material", "output": "host.os.type:\"windows\" and\nevent.category : \"authentication\" and event.action : \"logged-in\" and\nwinlog.logon.type : \"NewCredentials\" and event.outcome : \"success\" and\nuser.id : (S-1-5-21-* or S-1-12-1-*) and winlog.event_data.LogonProcessName : \"seclogo\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Identifies an unexpected file being modified by dns.exe, the process responsible for Windows DNS Server services, which\nmay indicate activity related ...", "output": "event.category : \"file\" and host.os.type : \"windows\" and\n  event.type : (\"creation\" or \"deletion\" or \"change\") and process.name : \"dns.exe\" and\n  not file.extension : (\"old\" or \"temp\" or \"bak\" or \"dns\" or \"arpa\" or \"log\")\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Valid Accounts", "output": "event.code:5136 and winlog.event_data.ObjectDN:CN=AdminSDHolder,CN=System*\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Create KQL query to detect: Identifies first-time modifications to scheduled tasks by user accounts, excluding system activity and machine accounts.\n", "output": "event.category: \"iam\" and event.code: \"4702\" and\n  not winlog.event_data.SubjectUserSid: (\"S-1-5-18\" or \"S-1-5-19\" or \"S-1-5-20\") and\n  not user.name : *$\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Server Software Component", "output": "host.os.type:windows and event.category:process and event.type:start and\nprocess.parent.name:\"sqlservr.exe\" and process.command_line : * and\n(\n  (\n    (process.name.caseless : \"cmd.exe\" or process.pe.original_file_name : \"Cmd.Exe\") and\n    not process.args : (\n          \\\\\\\\* or diskfree or rmdir or mkdir or dir or DIR or del or rename or bcp or md or ren or REN or send or echo or\n          ECHO or TYPE or type or EXIST or forfiles or sqlcmd or SQLCMD or dtexec or Sort-Object or cat or copy or COPY or\n          move or MOVE or CD\\\\ or show or rd or powercfg or \"C:\\SPAN4\\DATA\\RISKPARAM.SPN\" or (\"@ECHO\" and \"@FOR\") or\n          (\"@echo\" and \"@for\") or (SET and PATH=*) or (\"-ExecutionPolicy\" and \"-File\") or MSSQLFDLauncher$DATEV_DBENGINE or\n          (wmic and (cpu or computersystem or logicaldisk or os or ComputerSystem or volume)) or -s\\:C\\:\\\\WINDOWS\\\\SERVIC* or\n          D\\:\\\\* or E\\:\\\\* or F\\:\\\\* or Z\\:\\\\* or \"C:\\Program Files\\Amazon\\AWSCLIV2\\aws.exe\" or C\\:\\\\7-Zip\\\\7z.exe* or\n          C\\:\\\\FTP* or *\\(Get-Item* or C\\:\\\\ProgramData\\\\Daktronics*\n    ) and\n    not process.command_line : (\n          \"\\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\\" /c \" or\n          \"\\\"C:\\\\Windows\\\\System32\\\\cmd.exe\\\"\"\"    )\n  ) or\n  process.name.caseless:(\"bitsadmin.exe\" or \"certutil.exe\" or \"vpnbridge.exe\") or\n  process.name:(\"bitsadmin.exe\" or \"certutil.exe\" or \"vpnbridge.exe\") or\n  process.pe.original_file_name:(\"CertUtil.exe\" or \"bitsadmin.exe\" or \"vpnbridge.exe\")\n)\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Generate KQL for: Identifies suspicious commands executed via a web server, which may suggest a vulnerability and remote shell access.", "output": "host.os.type:windows and event.category:process and event.type:start and process.args : * and\n  process.parent.name:(\"w3wp.exe\" or \"httpd.exe\" or \"nginx.exe\" or \"php.exe\" or \"php-cgi.exe\" or \"tomcat.exe\") and\n  (\n    process.name : (\"cmd.exe\" or \"cscript.exe\" or \"powershell.exe\" or \"pwsh.exe\" or \"powershell_ise.exe\" or \"wmic.exe\" or \"wscript.exe\") or\n    process.name.caseless : (\"cmd.exe\" or \"cscript.exe\" or \"powershell.exe\" or \"pwsh.exe\" or \"powershell_ise.exe\" or \"wmic.exe\" or \"wscript.exe\")\n  ) and\n  not\n  (\n    process.command_line : (\n      \"cmd.exe /c mode CON\" or\n      \"cmd.exe /s /c \\\"mode CON\\\"\" or\n      \"cmd.exe /c \\\"mode\\\"\" or\n      \"cmd.exe /s /c \\\"tput colors 2>&1\\\"\" or\n      \"cmd.exe /s /c \\\"stty 2> NUL\\\"\" or\n      \"cmd.exe /s /c \\\"stty 2>&1\\\"\" or\n      \"cmd.exe /c \\\"stty 2>&1\\\"\" or\n      \"cmd.exe /s /c \\\"ipconfig /all 2>&1\\\"\" or\n      \"cmd.exe /s /c \\\"echo '%os%'\\\"\" or\n      *.\\\\install\\\\awk.exe*\n    ) or\n    process.args : (\\(git or (*artisan* and *queue\\:work*) or *rmdir* or \"mode CON\" or ver or ls or mode or dir)\n  )\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detects modifications in the msDS-ManagedAccountPrecededByLink attribute of a delegated managed service account by an unusual\nsubject account. Attacke...", "output": "event.code:5136 and winlog.event_data.AttributeLDAPDisplayName:\"msDS-ManagedAccountPrecededByLink\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Exploitation for Privilege Escalation", "output": "event.code:\"5136\" and winlog.event_data.AttributeLDAPDisplayName:\"msPKIAccountCredentials\" and\n  winlog.event_data.OperationType:\"%%14674\" and\n  not winlog.event_data.SubjectUserSid : \"S-1-5-18\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Valid Accounts", "output": "event.code:5137 and winlog.event_data.ObjectClass:\"msDS-DelegatedManagedServiceAccount\"\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Exploitation for Privilege Escalation", "output": "event.category:\"driver\" and host.os.type:windows and event.action:\"load\"\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detect suspicious activity related to Access Token Manipulation", "output": "event.category:\"authentication\" and host.os.type:\"windows\" and winlog.logon.type:\"NewCredentials\" and\n    winlog.event_data.LogonProcessName:Advapi* and\n    not winlog.event_data.SubjectUserName:*$ and\n    not process.executable: (C\\:\\\\Program*Files*\\(x86\\)\\\\*.exe or C\\:\\\\Program*Files\\\\*.exe)\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Detects scripts that contain PowerShell functions, structures, or Windows API functions related to token\nimpersonation/theft. Attackers may duplicate ...", "output": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text:(\n    \"Invoke-TokenManipulation\" or\n    \"ImpersonateNamedPipeClient\" or\n    \"NtImpersonateThread\" or\n    (\n      \"STARTUPINFOEX\" and\n      \"UpdateProcThreadAttribute\"\n    ) or\n    (\n      \"AdjustTokenPrivileges\" and\n      \"SeDebugPrivilege\"\n    ) or\n    (\n      (\"DuplicateToken\" or\n      \"DuplicateTokenEx\") and\n      (\"SetThreadToken\" or\n      \"ImpersonateLoggedOnUser\" or\n      \"CreateProcessWithTokenW\" or\n      \"CreatePRocessAsUserW\" or\n      \"CreateProcessAsUserA\")\n    ) \n  ) and\n  not (\n    user.id:(\"S-1-5-18\" or \"S-1-5-19\" or \"S-1-5-20\") and\n    file.directory: \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender Advanced Threat Protection\\\\Downloads\"\n  ) and\n  not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\" and \"PowerSploitIndicators\"\n  ) and\n  not (\n    powershell.file.script_block_text : \"New-HPPrivateToastNotificationLogo\" and\n    file.path : \"C:\\Program Files\\HPConnect\\hp-cmsl-wl\\modules\\HP.Notifications\\HP.Notifications.psm1\"\n  )\n", "source": "detection-rules/windows", "severity": "medium", "risk_score": 47}
{"task": "kql", "domain": "security", "instruction": "Write a detection rule for: Detects attempts to exploit privilege escalation vulnerabilities related to the Print Spooler service. For more\ninformation refer to the following CVE...", "output": "event.category : \"file\" and host.os.type : \"windows\" and event.type : \"creation\" and\n  process.name : \"spoolsv.exe\" and file.extension : \"dll\"\n", "source": "detection-rules/windows", "severity": "low", "risk_score": 21}
{"task": "kql", "domain": "security", "instruction": "Create detection for MITRE technique: Access Token Manipulation", "output": "event.category:iam and event.code:\"4674\" and\nwinlog.event_data.PrivilegeList:\"SeIncreaseBasePriorityPrivilege\" and event.outcome:\"success\" and\nwinlog.event_data.AccessMask:\"512\" and not winlog.event_data.SubjectUserSid:(\"S-1-5-18\" or \"S-1-5-19\" or \"S-1-5-20\")\n", "source": "detection-rules/windows", "severity": "high", "risk_score": 73}

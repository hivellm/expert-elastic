# Elasticsearch Grammar (GBNF format for llama.cpp)
# Supports: Query DSL (JSON), KQL (text), EQL (text), Mappings (JSON), Pipelines (JSON)

root ::= json | kql | eql

# JSON for Query DSL, Mappings, Pipelines
json ::= value

value ::= object | array | string | number | boolean | null

# Object
object ::= "{" ws "}" | "{" ws members ws "}"

members ::= member | member "," ws members

member ::= string ws ":" ws value

# Array
array ::= "[" ws "]" | "[" ws elements ws "]"

elements ::= value | value "," ws elements

# String
string ::= "\"" characters "\""

characters ::= "" | character characters

character ::=
    [^"\\] |
    "\\" escape

escape ::=
    "\"" |
    "\\" |
    "/" |
    "b" |
    "f" |
    "n" |
    "r" |
    "t" |
    "u" hex hex hex hex

hex ::= [0-9a-fA-F]

# Number
number ::= integer fraction exponent | integer fraction | integer exponent | integer

integer ::= "-" digit1-9 digits | "-" digit | digit1-9 digits | digit

digits ::= digit | digit digits

digit ::= [0-9]

digit1-9 ::= [1-9]

fraction ::= "." digits

exponent ::= "e" sign digits | "E" sign digits

sign ::= "+" | "-" | ""

# Boolean
boolean ::= "true" | "false"

# Null
null ::= "null"

# Whitespace
ws ::= "" | " " ws | "\n" ws | "\r" ws | "\t" ws

# KQL (Kibana Query Language) - simplified
# Format: field:value AND/OR field:value
kql ::= kql_term | kql_term ws kql_operator ws kql

kql_term ::= kql_field ws ":" ws kql_value | "(" kql ")"

kql_field ::= [a-zA-Z_] [a-zA-Z0-9_.]* 

kql_value ::= kql_quoted | kql_unquoted

kql_quoted ::= "\"" [^"]* "\""

kql_unquoted ::= [a-zA-Z0-9_*?.-]+

kql_operator ::= "and" | "AND" | "or" | "OR" | "not" | "NOT"

# EQL (Event Query Language) - simplified
# Format: [event_type where condition]
eql ::= eql_query | "sequence" ws eql_sequence

eql_query ::= "[" eql_event_type ws "where" ws eql_condition "]"

eql_event_type ::= [a-zA-Z_][a-zA-Z0-9_]*

eql_condition ::= eql_field ws eql_op ws eql_value | eql_condition ws "and" ws eql_condition | eql_condition ws "or" ws eql_condition

eql_field ::= [a-zA-Z_][a-zA-Z0-9_.]*

eql_op ::= "==" | "!=" | ">" | "<" | ">=" | "<="

eql_value ::= "\"" [^"]* "\"" | [a-zA-Z0-9_]+

eql_sequence ::= "by" ws eql_field ws "with" ws "maxspan" ws "=" ws [0-9]+ [smhd] ws eql_query ws eql_query

